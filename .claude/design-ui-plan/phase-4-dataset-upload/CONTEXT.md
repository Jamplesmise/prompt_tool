# Phase 4: 数据集上传优化

## 阶段概述

**目标**：优化数据集上传流程，增加预览、字段映射和卡片化展示

**优先级**：P1

**前置依赖**：无

**涉及页面**：`/datasets` (数据集管理)

## 当前问题

1. 存储方式列信息展示不直观
2. 下载模板和上传按钮视觉权重相同
3. 缺少数据预览快照
4. 字段映射不够智能

## 优化目标

### 上传体验优化
- 拖拽上传区域更醒目
- 上传后即时预览
- 智能字段映射
- 存储选项清晰

### 列表展示优化
- 支持卡片视图切换
- 数据快照预览
- 存储类型图标化

## 设计规范

### 上传弹窗布局
```
┌─────────────────────────────────────────────────────────────────────────┐
│  上传数据集                                                    [关闭 ×] │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ┌───────────────────────────────────────────────────────────────────┐  │
│  │                                                                   │  │
│  │              ╭──────────────────────────────────╮                 │  │
│  │              │        📁                        │                 │  │
│  │              │                                  │                 │  │
│  │              │   拖拽文件到此处或点击上传        │                 │  │
│  │              │   支持 .xlsx, .csv 格式          │                 │  │
│  │              │   单文件最大 50MB                │                 │  │
│  │              │                                  │                 │  │
│  │              ╰──────────────────────────────────╯                 │  │
│  │                                                                   │  │
│  │  📥 下载模板: [基础模板] [带期望输出模板]                         │  │
│  │                                                                   │  │
│  └───────────────────────────────────────────────────────────────────┘  │
│                                                                         │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━ 上传后 ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━  │
│                                                                         │
│  📊 数据预览 (共 100 行)                                                │
│  ┌───────────────────────────────────────────────────────────────────┐  │
│  │  input                    │ expected       │ category   │ ...    │  │
│  ├───────────────────────────────────────────────────────────────────┤  │
│  │  什么是人工智能？          │ AI是一种...    │ 科技      │ ...    │  │
│  │  如何学习编程？            │ 建议从...      │ 教育      │ ...    │  │
│  └───────────────────────────────────────────────────────────────────┘  │
│                                                                         │
│  📋 字段映射                                                            │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │  原始字段          →          系统字段                           │   │
│  │  ─────────────────────────────────────────────────────────────   │   │
│  │  input            →          input (输入) ✅ 自动识别            │   │
│  │  expected         →          expected (期望输出) ✅              │   │
│  │  category         →          metadata.category                   │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  ⚙️ 存储选项                                                            │
│  ○ 临时存储 (任务完成后自动清理)                                        │
│  ● 持久化存储 (长期保留，可复用)                                        │
│                                                                         │
│                                            [取消]  [确认上传]           │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 卡片视图布局
```
┌─────────────────────────────────────────────────────────────────────────┐
│  数据集管理                                [列表视图] [卡片视图]         │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐         │
│  │ 📊 客服对话测试集│  │ 📊 分类任务数据 │  │ 📊 翻译质量数据 │         │
│  │                 │  │                 │  │                 │         │
│  │ 行数: 1,234     │  │ 行数: 567       │  │ 行数: 890       │         │
│  │ 存储: 持久化 💾 │  │ 存储: 临时 ⏱️   │  │ 存储: 持久化 💾 │         │
│  │ 更新: 2小时前   │  │ 更新: 昨天      │  │ 更新: 3天前     │         │
│  │                 │  │                 │  │                 │         │
│  │ [查看] [导出]   │  │ [查看] [导出]   │  │ [查看] [导出]   │         │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘         │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 存储类型图标
| 类型 | 图标 | 颜色 |
|------|------|------|
| 持久化 | 💾 | #52C41A |
| 临时 | ⏱️ | #FAAD14 |

## 涉及文件

```
apps/web/src/
├── app/(dashboard)/datasets/page.tsx       # 数据集列表页面
├── components/dataset/
│   ├── DatasetUploadModal.tsx              # 上传弹窗组件 (新增)
│   ├── DatasetPreview.tsx                  # 数据预览组件 (新增)
│   ├── FieldMapper.tsx                     # 字段映射组件 (新增)
│   ├── DatasetCard.tsx                     # 卡片组件 (新增)
│   ├── ViewToggle.tsx                      # 视图切换组件 (新增)
│   └── index.ts
└── hooks/
    └── useDatasetUpload.ts                 # 上传 Hook (新增)
```

## API 依赖

复用现有接口：
- `POST /api/v1/datasets/upload` - 上传
- `GET /api/v1/datasets` - 列表
- `GET /api/v1/datasets/:id/preview` - 预览

## 验收标准

### 功能
- [ ] 拖拽上传正常
- [ ] 数据预览正确
- [ ] 字段自动映射
- [ ] 视图切换正常

### 视觉
- [ ] 上传区域醒目
- [ ] 卡片样式一致
- [ ] 存储类型图标清晰

### 性能
- [ ] 大文件上传进度显示
- [ ] 预览渲染快速

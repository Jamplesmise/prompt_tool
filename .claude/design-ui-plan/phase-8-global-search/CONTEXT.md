# Phase 8: 全局搜索与快捷键

## 阶段概述

**目标**：实现全局搜索功能和快捷键支持，提升操作效率

**优先级**：P2

**前置依赖**：无

**涉及范围**：全局功能，跨页面

## 当前问题

1. 缺乏全局搜索功能
2. 常用操作需要多次点击
3. 没有键盘快捷键支持
4. 资源跳转路径长

## 优化目标

### 全局搜索
- Ctrl/Cmd + K 唤起搜索
- 搜索提示词、数据集、任务
- 支持命令执行
- 最近访问记录

### 快捷键系统
- 常用操作快捷键
- 快捷键帮助面板
- 可配置（后续）

## 设计规范

### 全局搜索弹窗
```
┌─────────────────────────────────────────────────────────────────┐
│ 🔍 搜索提示词、数据集、任务...                    Ctrl+K 关闭   │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│ 📝 提示词                                                       │
│   • GPT-4 通用助手                                    v3       │
│   • 分类任务模板                                      v2       │
│                                                                 │
│ 📊 数据集                                                       │
│   • 客服对话测试集                                 1,234行     │
│                                                                 │
│ ⚡ 任务                                                         │
│   • GPT-4 客服对话测试                            执行中       │
│                                                                 │
│ ─────────────────────────────────────────────────────────────  │
│ 💡 输入 > 可执行命令: 新建任务、上传数据集、添加模型...          │
└─────────────────────────────────────────────────────────────────┘
```

### 命令模式
```
┌─────────────────────────────────────────────────────────────────┐
│ > 新建任务                                          Ctrl+K 关闭│
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│ 📋 可用命令                                                     │
│                                                                 │
│   > 新建测试任务                                   Ctrl+N      │
│   > 新建 A/B 测试                                              │
│   > 新建提示词                                                 │
│   > 上传数据集                                                 │
│   > 添加模型提供商                                             │
│   > 新建评估器                                                 │
│   > 打开设置                                       Ctrl+,      │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 快捷键帮助
```
┌─────────────────────────────────────────────────────────────────┐
│  ⌨️ 快捷键帮助                                        [关闭 ×]  │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  全局                                                           │
│  ─────────────────────────────────────────────────────────────  │
│  Ctrl/Cmd + K          打开全局搜索                             │
│  Ctrl/Cmd + N          新建任务                                 │
│  Ctrl/Cmd + ,          打开设置                                 │
│  ?                     显示快捷键帮助                           │
│                                                                 │
│  编辑                                                           │
│  ─────────────────────────────────────────────────────────────  │
│  Ctrl/Cmd + S          保存当前编辑                             │
│  Escape                关闭弹窗/取消                            │
│                                                                 │
│  导航                                                           │
│  ─────────────────────────────────────────────────────────────  │
│  ↑ ↓                   上下移动选择                             │
│  Enter                 确认选择                                 │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 快捷键列表
| 快捷键 | 功能 |
|--------|------|
| `Ctrl/Cmd + K` | 全局搜索 |
| `Ctrl/Cmd + N` | 新建任务 |
| `Ctrl/Cmd + S` | 保存当前编辑 |
| `Ctrl/Cmd + ,` | 打开设置 |
| `Escape` | 关闭弹窗/返回 |
| `?` | 显示快捷键帮助 |

## 涉及文件

```
apps/web/src/
├── components/global/
│   ├── GlobalSearch.tsx                    # 全局搜索组件 (新增)
│   ├── CommandPalette.tsx                  # 命令面板组件 (新增)
│   ├── KeyboardShortcutsHelp.tsx           # 快捷键帮助组件 (新增)
│   └── index.ts
├── hooks/
│   ├── useGlobalSearch.ts                  # 全局搜索 Hook (新增)
│   ├── useHotkeys.ts                       # 快捷键 Hook (新增)
│   └── useCommandPalette.ts                # 命令面板 Hook (新增)
├── providers/
│   └── HotkeysProvider.tsx                 # 快捷键上下文 (新增)
└── app/layout.tsx                          # 根布局 (修改)
```

## API 依赖

新增接口：
- `GET /api/v1/search?q=keyword&types=prompt,dataset,task` - 全局搜索

复用接口：
- `GET /api/v1/prompts` - 提示词列表
- `GET /api/v1/datasets` - 数据集列表
- `GET /api/v1/tasks` - 任务列表

## 验收标准

### 功能
- [ ] Ctrl+K 唤起搜索
- [ ] 搜索结果分类显示
- [ ] 命令模式正常
- [ ] 快捷键正常工作

### 视觉
- [ ] 弹窗样式正确
- [ ] 键盘导航高亮
- [ ] 快捷键标签显示

### 性能
- [ ] 搜索响应 < 200ms
- [ ] 弹窗打开流畅

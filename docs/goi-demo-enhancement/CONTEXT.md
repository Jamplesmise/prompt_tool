# GOI Demo å¢å¼ºè®¡åˆ’ - èƒŒæ™¯æ–‡æ¡£

> ç‰ˆæœ¬ï¼šv1.0
> æ—¥æœŸï¼š2024-12
> ç›®æ ‡ï¼šå°† GOI ä»"å¯¼èˆªåŠ©æ‰‹"å‡çº§ä¸º"æœ‰è¯´æœåŠ›çš„æŠ€æœ¯æ¼”ç¤º"

---

## ä¸€ã€é—®é¢˜åˆ†æ

### 1.1 å½“å‰å®ç°çŠ¶æ€

GOI L2 å·²å®ç°çš„åŠŸèƒ½ï¼š

| ç»„ä»¶ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| Copilot é¢æ¿ UI | âœ… å®Œæˆ | æ‚¬æµ®çª—å£ã€TODO List å±•ç¤ºã€æ£€æŸ¥ç‚¹ç¡®è®¤ |
| ä¸‰ç§åä½œæ¨¡å¼ | âœ… å®Œæˆ | æ‰‹åŠ¨/è¾…åŠ©/è‡ªåŠ¨æ¨¡å¼åˆ‡æ¢ |
| Access Handler | âš ï¸ éƒ¨åˆ† | åªå®ç°äº†é¡µé¢å¯¼èˆªï¼Œæ— æ³•æ“ä½œ UI æ§ä»¶ |
| State Handler | âŒ æœªå®ç° | æ— æ³•æ‰§è¡Œæ•°æ®åˆ›å»º/æ›´æ–°/åˆ é™¤ |
| Observation Handler | âŒ æœªå®ç° | æ— æ³•æŸ¥è¯¢èµ„æºçŠ¶æ€ |
| Plan Prompt | âœ… å®Œæˆ | LLM å¯ä»¥ç”Ÿæˆ TODO List |
| TODO æ‰§è¡Œå¼•æ“ | âš ï¸ éƒ¨åˆ† | åªèƒ½æ‰§è¡Œ Accessï¼Œå¡åœ¨éœ€è¦æ•°æ®æ“ä½œçš„æ­¥éª¤ |

### 1.2 æ ¸å¿ƒé—®é¢˜

**ç°çŠ¶**ï¼šç”¨æˆ·è¯´"å¸®æˆ‘åˆ›å»ºä¸€ä¸ªæç¤ºè¯"ï¼Œç³»ç»Ÿåªèƒ½æ‰“å¼€åˆ›å»ºé¡µé¢ï¼Œç„¶åç”¨æˆ·è¿˜å¾—è‡ªå·±å¡«è¡¨å•ã€‚

**é—®é¢˜**ï¼šè¿™å’Œç”¨æˆ·è‡ªå·±ç‚¹èœå•æ²¡æœ‰æœ¬è´¨åŒºåˆ«ï¼Œæ— æ³•ä½“ç° GOI çš„æ ¸å¿ƒä»·å€¼ã€‚

**æ ¹å› **ï¼šState Handler æœªå®ç°ï¼ŒAI åªèƒ½"å¯¼èˆª"ä¸èƒ½"æ“ä½œ"ã€‚

### 1.3 GOI è®ºæ–‡ vs å½“å‰å®ç°

| ç»´åº¦ | è®ºæ–‡ GOI | å½“å‰å®ç° |
|------|---------|---------|
| Access | `visit(["control_id"])` è®¿é—®æ§ä»¶ | `router.push(url)` é¡µé¢è·³è½¬ |
| State | `set_scrollbar_pos()` æ“ä½œæ§ä»¶çŠ¶æ€ | âŒ æœªå®ç° |
| Observation | `get_texts()` è¯»å–æ§ä»¶å†…å®¹ | âŒ æœªå®ç° |
| æœºåˆ¶å±‚ | ç³»ç»Ÿè‡ªåŠ¨å®Œæˆæ‰€æœ‰ UI æ“ä½œ | ç”¨æˆ·æ‰‹åŠ¨æ“ä½œ |

---

## äºŒã€ç›®æ ‡å®šä¹‰

### 2.1 Demo ç›®æ ‡

æ‰“é€ ä¸€ä¸ª**æœ‰è¯´æœåŠ›çš„æŠ€æœ¯æ¼”ç¤º**ï¼Œå±•ç¤º GOI çš„ä¸‰ä¸ªæ ¸å¿ƒä»·å€¼ï¼š

1. **ç­–ç•¥ä¸æœºåˆ¶åˆ†ç¦»**ï¼šç”¨æˆ·åªè¯´ç›®æ ‡ï¼Œç³»ç»Ÿè‡ªåŠ¨æ‰§è¡Œ
2. **å¤šæ­¥éª¤ä»»åŠ¡ç¼–æ’**ï¼šTODO List è‡ªåŠ¨æ¨è¿›
3. **äººæœºåä½œ**ï¼šå…³é”®æ­¥éª¤æš‚åœç¡®è®¤ï¼Œç”¨æˆ·ä¿æŒæ§åˆ¶æƒ

### 2.2 æ¼”ç¤ºåœºæ™¯

é€‰æ‹©**æœ€èƒ½ä½“ç°ä»·å€¼çš„ç«¯åˆ°ç«¯åœºæ™¯**ï¼š

```
ç”¨æˆ·è¾“å…¥: "å¸®æˆ‘åˆ›å»ºä¸€ä¸ªæƒ…æ„Ÿåˆ†ææç¤ºè¯ï¼Œç”¨æµ‹è¯•æ•°æ®é›†è·‘ä¸€ä¸‹çœ‹çœ‹æ•ˆæœ"

ç³»ç»Ÿæ‰§è¡Œ:
  âœ… 1. åˆ›å»ºæç¤ºè¯ï¼ˆåç§°ã€å†…å®¹è‡ªåŠ¨å¡«å……ï¼‰
  ğŸ”„ 2. é€‰æ‹©æ•°æ®é›† [checkpoint: ç¡®è®¤ä½¿ç”¨å“ªä¸ªæ•°æ®é›†]
  â¸ 3. é€‰æ‹©æ¨¡å‹
  â¸ 4. åˆ›å»ºæµ‹è¯•ä»»åŠ¡
  ğŸ”„ 5. æ‰§è¡Œä»»åŠ¡ [checkpoint: ç¡®è®¤å¼€å§‹æ‰§è¡Œ]
  â¸ 6. å±•ç¤ºç»“æœæ‘˜è¦

ç”¨æˆ·æ“ä½œ: åªéœ€åœ¨ 2 ä¸ª checkpoint ç‚¹å‡»ç¡®è®¤
```

### 2.3 æˆåŠŸæ ‡å‡†

- [ ] ç”¨æˆ·ä¸€å¥è¯æè¿°éœ€æ±‚ï¼Œç³»ç»Ÿè‡ªåŠ¨å®Œæˆ 80% çš„æ“ä½œ
- [ ] TODO List å®æ—¶å±•ç¤ºæ‰§è¡Œè¿›åº¦
- [ ] å…³é”®æ­¥éª¤æœ‰ checkpoint ç¡®è®¤
- [ ] æ‰§è¡Œå¤±è´¥èƒ½ç»™å‡ºæ¸…æ™°æç¤º
- [ ] æ•´ä¸ªæµç¨‹åœ¨ 2 åˆ†é’Ÿå†…å®Œæˆ

---

## ä¸‰ã€æŠ€æœ¯æ–¹æ¡ˆ

### 3.1 æ¶æ„è¡¥å…¨

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚          Copilot é¢æ¿ (å·²å®Œæˆ)       â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚          Agent Loop (å·²å®Œæˆ)         â”‚
                    â”‚     Plan â†’ Gather â†’ Act â†’ Verify    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚          GOI Executor               â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                           â”‚                           â”‚
          â–¼                           â–¼                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Access Handler â”‚       â”‚  State Handler  â”‚       â”‚Observation Handlerâ”‚
â”‚    (éƒ¨åˆ†å®Œæˆ)    â”‚       â”‚   (éœ€è¦å®ç°)    â”‚       â”‚    (éœ€è¦å®ç°)    â”‚
â”‚                 â”‚       â”‚                 â”‚       â”‚                 â”‚
â”‚ â€¢ é¡µé¢å¯¼èˆª âœ…    â”‚       â”‚ â€¢ åˆ›å»ºèµ„æº      â”‚       â”‚ â€¢ æŸ¥è¯¢èµ„æº      â”‚
â”‚ â€¢ æ‰“å¼€å¼¹çª— âœ…    â”‚       â”‚ â€¢ æ›´æ–°èµ„æº      â”‚       â”‚ â€¢ è·å–çŠ¶æ€      â”‚
â”‚ â€¢ è¡¨å•é¢„å¡« âŒ    â”‚       â”‚ â€¢ åˆ é™¤èµ„æº      â”‚       â”‚ â€¢ ç»Ÿè®¡ä¿¡æ¯      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                           â”‚                           â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚        Core API Layer (å·²æœ‰)        â”‚
                    â”‚  Prompt / Dataset / Task / Model    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 State Handler è®¾è®¡

State Handler è´Ÿè´£æ‰§è¡Œæ•°æ®å˜æ›´æ“ä½œï¼Œæ ¸å¿ƒæ˜¯è°ƒç”¨ç°æœ‰ APIï¼š

```typescript
// State æ“ä½œå®šä¹‰
type StateOperation = {
  type: 'state'
  target: {
    resourceType: ResourceType  // prompt, dataset, task, etc.
    resourceId?: string         // æ›´æ–°/åˆ é™¤æ—¶éœ€è¦
  }
  action: 'create' | 'update' | 'delete'
  expectedState: Record<string, unknown>  // æœŸæœ›çš„æ•°æ®
}

// State Handler æ‰§è¡Œæµç¨‹
async function executeState(operation: StateOperation) {
  // 1. æ ¹æ® resourceType å’Œ action ç¡®å®š API ç«¯ç‚¹
  const endpoint = getApiEndpoint(operation)

  // 2. è°ƒç”¨ API
  const result = await fetch(endpoint, {
    method: getMethod(operation.action),
    body: JSON.stringify(operation.expectedState)
  })

  // 3. éªŒè¯ç»“æœ
  if (!result.ok) {
    throw new Error(`State operation failed: ${result.statusText}`)
  }

  // 4. è¿”å›åˆ›å»º/æ›´æ–°åçš„èµ„æº
  return result.json()
}
```

### 3.3 Observation Handler è®¾è®¡

Observation Handler è´Ÿè´£æŸ¥è¯¢ä¿¡æ¯ï¼Œç”¨äºæ”¶é›†ä¸Šä¸‹æ–‡å’ŒéªŒè¯ç»“æœï¼š

```typescript
// Observation æ“ä½œå®šä¹‰
type ObservationOperation = {
  type: 'observation'
  queries: Array<{
    resourceType: ResourceType
    resourceId?: string
    fields: string[]           // è¦æŸ¥è¯¢çš„å­—æ®µ
    filters?: Record<string, unknown>
  }>
}

// Observation Handler æ‰§è¡Œæµç¨‹
async function executeObservation(operation: ObservationOperation) {
  const results = await Promise.all(
    operation.queries.map(async (query) => {
      const endpoint = getQueryEndpoint(query)
      const response = await fetch(endpoint)
      return response.json()
    })
  )
  return results
}
```

### 3.4 æ¼”ç¤ºåœºæ™¯å®ç°

ä»¥"åˆ›å»ºæç¤ºè¯å¹¶æ‰§è¡Œæµ‹è¯•"ä¸ºä¾‹ï¼š

```
ç”¨æˆ·: "å¸®æˆ‘åˆ›å»ºä¸€ä¸ªæƒ…æ„Ÿåˆ†ææç¤ºè¯ï¼Œç”¨æµ‹è¯•æ•°æ®é›†è·‘ä¸€ä¸‹"

LLM ç”Ÿæˆ TODO List:
[
  {
    id: "1",
    title: "åˆ›å»ºæƒ…æ„Ÿåˆ†ææç¤ºè¯",
    category: "state",
    goiOperation: {
      type: "state",
      target: { resourceType: "prompt" },
      action: "create",
      expectedState: {
        name: "æƒ…æ„Ÿåˆ†ææç¤ºè¯",
        content: "ä½ æ˜¯ä¸€ä¸ªæƒ…æ„Ÿåˆ†æåŠ©æ‰‹ï¼Œè¯·åˆ†æä»¥ä¸‹æ–‡æœ¬çš„æƒ…æ„Ÿå€¾å‘...",
        description: "ç”¨äºåˆ†ææ–‡æœ¬æƒ…æ„Ÿçš„æç¤ºè¯"
      }
    },
    checkpoint: { required: false }
  },
  {
    id: "2",
    title: "æŸ¥æ‰¾æµ‹è¯•æ•°æ®é›†",
    category: "observation",
    goiOperation: {
      type: "observation",
      queries: [{
        resourceType: "dataset",
        filters: { name: { contains: "æµ‹è¯•" } },
        fields: ["id", "name", "itemCount"]
      }]
    },
    checkpoint: { required: true, message: "ç¡®è®¤ä½¿ç”¨è¿™ä¸ªæ•°æ®é›†ï¼Ÿ" }
  },
  {
    id: "3",
    title: "åˆ›å»ºæµ‹è¯•ä»»åŠ¡",
    category: "state",
    goiOperation: {
      type: "state",
      target: { resourceType: "task" },
      action: "create",
      expectedState: {
        name: "æƒ…æ„Ÿåˆ†ææµ‹è¯•",
        promptId: "$1.result.id",      // å¼•ç”¨æ­¥éª¤1çš„ç»“æœ
        datasetId: "$2.result[0].id",  // å¼•ç”¨æ­¥éª¤2çš„ç»“æœ
        // ...
      }
    },
    checkpoint: { required: true, message: "ç¡®è®¤åˆ›å»ºå¹¶æ‰§è¡Œä»»åŠ¡ï¼Ÿ" }
  },
  // ...
]
```

---

## å››ã€å‚è€ƒèµ„æº

### 4.1 ç°æœ‰ä»£ç ä½ç½®

| æ¨¡å— | è·¯å¾„ |
|------|------|
| GOI ç±»å‹å®šä¹‰ | `packages/shared/types/goi.ts` |
| Access Handler | `apps/web/src/lib/goi/executor/accessHandler.ts` |
| Plan Prompt | `apps/web/src/lib/goi/prompts/planPrompt.ts` |
| Copilot Hook | `apps/web/src/components/goi/hooks/useCopilot.ts` |
| TODO å±•ç¤º | `apps/web/src/components/goi/CopilotPanel/TodoListView.tsx` |
| GOI è½¬å‹æ–¹æ¡ˆ | `docs/goi-transformation-plan.md` |

### 4.2 ç°æœ‰ API ç«¯ç‚¹

State Handler éœ€è¦è°ƒç”¨çš„ APIï¼š

| èµ„æº | åˆ›å»º | æ›´æ–° | åˆ é™¤ |
|------|------|------|------|
| Prompt | POST /api/prompts | PUT /api/prompts/[id] | DELETE /api/prompts/[id] |
| Dataset | POST /api/datasets | PUT /api/datasets/[id] | DELETE /api/datasets/[id] |
| Task | POST /api/tasks | PUT /api/tasks/[id] | DELETE /api/tasks/[id] |
| Model | POST /api/models | PUT /api/models/[id] | DELETE /api/models/[id] |

### 4.3 ç›¸å…³æ–‡æ¡£

- GOI åŸå§‹è®ºæ–‡ï¼š`docs/2510.04607v1.pdf`
- GOI è½¬å‹æ€»æ–¹æ¡ˆï¼š`docs/goi-transformation-plan.md`
- GOI L2 å‡çº§è®¡åˆ’ï¼š`docs/goi-l2-upgrade/`

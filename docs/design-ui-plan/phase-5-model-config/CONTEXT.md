# Phase 5: 模型配置优化

## 阶段概述

**目标**：优化模型配置页面，强化提供商分组、连接状态可视化和快速测试功能

**优先级**：P1

**前置依赖**：无

**涉及页面**：`/models` (模型配置)

## 当前问题

1. 提供商分组不够清晰
2. 模型状态标识太小
3. 连接测试入口不够明显
4. 模型卡片信息不完整

## 优化目标

### 分组层次强化
- 提供商作为一级分组
- 每个提供商可折叠展开
- 提供商级别状态指示

### 连接状态可视化
- 🟢 绿色 = 连接正常
- 🟡 黄色 = 连接慢（延迟 > 2s）
- 🔴 红色 = 连接失败

### 快速测试功能
- 提供商级别快速测试
- 单模型快速测试
- 测试结果实时展示

## 设计规范

### 分组布局
```
┌───────────────────────────────────────────────────────────────────────────┐
│  模型配置                                              + 添加提供商        │
├───────────────────────────────────────────────────────────────────────────┤
│                                                                           │
│  ┌─────────────────────────────────────────────────────────────────────┐  │
│  │ 🟢 OpenAI                                          [编辑] [测试]    │  │
│  │ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ │  │
│  │ Base URL: https://api.openai.com/v1                                 │  │
│  │ API Key: sk-****************************1234                       │  │
│  │                                                                     │  │
│  │   ┌──────────────┐  ┌──────────────┐  ┌──────────────┐             │  │
│  │   │ gpt-4o       │  │ gpt-4o-mini  │  │ + 添加模型   │             │  │
│  │   │ ───────────  │  │ ───────────  │  │              │             │  │
│  │   │ ✅ 已连接    │  │ ✅ 已连接    │  │              │             │  │
│  │   │ Temp: 0.7    │  │ Temp: 0.7    │  │              │             │  │
│  │   │ ───────────  │  │ ───────────  │  │              │             │  │
│  │   │ [测试][编辑] │  │ [测试][编辑] │  │              │             │  │
│  │   └──────────────┘  └──────────────┘  └──────────────┘             │  │
│  │                                                                     │  │
│  └─────────────────────────────────────────────────────────────────────┘  │
│                                                                           │
│  ┌─────────────────────────────────────────────────────────────────────┐  │
│  │ 🔴 Anthropic (连接失败)                             [编辑] [重试]   │  │
│  │ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ │  │
│  │ ⚠️ API Key 已过期，请更新                                           │  │
│  └─────────────────────────────────────────────────────────────────────┘  │
│                                                                           │
└───────────────────────────────────────────────────────────────────────────┘
```

### 模型卡片详情
```
┌──────────────────────┐
│ gpt-4o               │
│ ─────────────────── │
│ ✅ 已连接            │ ← 连接状态
│ 延迟: 1.2s           │ ← 最后测试延迟
│ ─────────────────── │
│ Temperature: 0.7     │ ← 默认参数
│ Max Tokens: 4096     │
│ ─────────────────── │
│ 最后测试: 5分钟前    │
│ ─────────────────── │
│ [测试] [编辑] [删除] │
└──────────────────────┘
```

### 测试结果弹窗
```
┌───────────────────────────────────────────────────────────────────┐
│  连接测试结果                                                      │
├───────────────────────────────────────────────────────────────────┤
│                                                                   │
│  模型: gpt-4o                                                     │
│  提供商: OpenAI                                                   │
│                                                                   │
│  ┌─────────────────────────────────────────────────────────────┐  │
│  │ ✅ 连接成功                                                 │  │
│  │                                                             │  │
│  │ 响应延迟: 1.23 秒                                           │  │
│  │ Token 消耗: 15 (input) + 8 (output) = 23                    │  │
│  │                                                             │  │
│  │ 测试响应:                                                   │  │
│  │ ┌─────────────────────────────────────────────────────────┐│  │
│  │ │ Hello! I'm an AI assistant. How can I help you today?  ││  │
│  │ └─────────────────────────────────────────────────────────┘│  │
│  └─────────────────────────────────────────────────────────────┘  │
│                                                                   │
│                                              [关闭]               │
└───────────────────────────────────────────────────────────────────┘
```

## 涉及文件

```
apps/web/src/
├── app/(dashboard)/models/page.tsx         # 模型配置页面
├── components/model/
│   ├── ProviderGroup.tsx                   # 提供商分组组件 (新增)
│   ├── ModelCard.tsx                       # 模型卡片组件 (新增)
│   ├── ConnectionStatus.tsx                # 连接状态组件 (新增)
│   ├── TestResultModal.tsx                 # 测试结果弹窗 (新增)
│   ├── AddProviderModal.tsx                # 添加提供商弹窗 (新增)
│   └── index.ts
└── hooks/
    └── useModelTest.ts                     # 模型测试 Hook (新增)
```

## API 依赖

复用现有接口：
- `GET /api/v1/providers` - 提供商列表
- `POST /api/v1/providers/:id/test` - 测试提供商
- `POST /api/v1/models/:id/test` - 测试模型

## 验收标准

### 功能
- [ ] 提供商分组展示正确
- [ ] 连接状态实时显示
- [ ] 快速测试功能正常
- [ ] 折叠展开正常

### 视觉
- [ ] 状态颜色正确
- [ ] 卡片布局整齐
- [ ] 错误提示醒目

### 性能
- [ ] 测试响应及时
- [ ] 页面渲染流畅

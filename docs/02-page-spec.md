# 页面规格说明

## 一、页面清单

| 路由 | 页面名称 | 优先级 |
|------|----------|--------|
| `/login` | 登录页 | MVP |
| `/` | 工作台 | MVP |
| `/prompts` | 提示词列表 | MVP |
| `/prompts/[id]` | 提示词详情/编辑 | MVP |
| `/datasets` | 数据集列表 | MVP |
| `/datasets/[id]` | 数据集详情 | MVP |
| `/models` | 模型配置 | MVP |
| `/evaluators` | 评估器列表 | MVP |
| `/evaluators/[id]` | 评估器编辑 | MVP |
| `/tasks` | 任务列表 | MVP |
| `/tasks/new` | 创建任务 | MVP |
| `/tasks/[id]` | 任务详情/结果 | MVP |
| `/monitor` | 监控中心 | V2 |
| `/settings` | 系统设置 | V2 |

---

## 二、布局结构

### 2.1 整体布局

```
┌─────────────────────────────────────────────────────────────────┐
│ Header (64px)                                      [用户头像 ▼] │
├──────────┬──────────────────────────────────────────────────────┤
│ Sidebar  │                                                      │
│ (200px)  │                    Content                           │
│          │                                                      │
│ - 工作台  │                                                      │
│ - 提示词  │                                                      │
│ - 数据集  │                                                      │
│ - 模型    │                                                      │
│ - 评估器  │                                                      │
│ - 任务    │                                                      │
│ - 监控    │                                                      │
│ ──────── │                                                      │
│ - 设置    │                                                      │
└──────────┴──────────────────────────────────────────────────────┘
```

### 2.2 布局组件

使用 Ant Design Pro Layout：

```tsx
// 使用 ProLayout 组件
import { ProLayout } from '@ant-design/pro-components';
```

---

## 三、各页面详细规格

### 3.1 登录页 `/login`

**布局**：居中卡片，无侧边栏

**表单字段**：

| 字段 | 类型 | 必填 | 校验 |
|------|------|------|------|
| 邮箱 | email | 是 | 邮箱格式 |
| 密码 | password | 是 | 最少6位 |

**交互**：
- 登录成功跳转 `/`
- 登录失败显示错误提示

---

### 3.2 工作台 `/`

**布局**：统计卡片 + 列表

**区块**：

| 区块 | 内容 |
|------|------|
| 统计卡片（4个） | 提示词数量、数据集数量、本周任务数、成功率 |
| 最近任务 | 最近 10 个任务，状态、时间、快捷操作 |
| 快捷入口 | 新建任务、上传数据集 |

**数据刷新**：进入页面时获取，无自动刷新

---

### 3.3 提示词列表 `/prompts`

**布局**：工具栏 + 表格

**工具栏**：
- 搜索框（按名称搜索）
- 新建按钮

**表格列**：

| 列名 | 字段 | 宽度 | 排序 |
|------|------|------|------|
| 名称 | name | 200px | 否 |
| 描述 | description | auto | 否 |
| 当前版本 | currentVersion | 100px | 否 |
| 更新时间 | updatedAt | 180px | 是 |
| 操作 | - | 150px | 否 |

**操作列**：
- 编辑：跳转详情页
- 快速测试：打开抽屉
- 删除：二次确认

**分页**：每页 20 条

---

### 3.4 提示词详情 `/prompts/[id]`

**布局**：左右分栏

```
┌─────────────────────────────────────────────────────────────────┐
│ [返回] 提示词名称                            [保存草稿] [发布]  │
├────────────────────────────────┬────────────────────────────────┤
│                                │                                │
│         编辑器区域              │           侧边栏               │
│                                │                                │
│  ┌──────────────────────────┐  │  ┌──────────────────────────┐  │
│  │                          │  │  │ 版本历史                 │  │
│  │     Monaco Editor        │  │  │ - v3 (当前) 2024-01-15  │  │
│  │                          │  │  │ - v2 2024-01-10         │  │
│  │                          │  │  │ - v1 2024-01-05         │  │
│  │                          │  │  └──────────────────────────┘  │
│  └──────────────────────────┘  │                                │
│                                │  ┌──────────────────────────┐  │
│  变量列表：                     │  │ 快速测试                 │  │
│  - role (string)               │  │ 模型: [选择 ▼]           │  │
│  - question (string)           │  │ 变量输入...              │  │
│                                │  │ [运行测试]               │  │
│                                │  └──────────────────────────┘  │
└────────────────────────────────┴────────────────────────────────┘
```

**编辑器区域**：
- Monaco Editor，语言设为 `markdown` 或 `plaintext`
- 高亮 `{{变量}}` 语法
- 自动提取变量列表

**版本历史**：
- 点击版本号查看内容（只读）
- 对比按钮：选择两个版本对比
- 回滚按钮：确认后回滚

**快速测试**：
- 选择模型
- 填写变量值
- 运行并显示结果

**按钮逻辑**：
- 保存草稿：保存到 `content` 字段，不创建版本
- 发布：创建新版本，需填写变更说明

---

### 3.5 数据集列表 `/datasets`

**布局**：工具栏 + 表格

**工具栏**：
- 搜索框
- 下载模板（下拉：基础模板、带期望输出模板）
- 上传数据集

**表格列**：

| 列名 | 字段 | 宽度 |
|------|------|------|
| 名称 | name | 200px |
| 描述 | description | auto |
| 行数 | rowCount | 100px |
| 存储方式 | isPersistent | 100px |
| 更新时间 | updatedAt | 180px |
| 操作 | - | 120px |

**上传流程**：
1. 选择文件（xlsx/csv）
2. 解析预览（显示前 5 行）
3. 字段映射（自动识别 input/expected）
4. 选择存储方式（临时/持久化）
5. 确认上传

---

### 3.6 数据集详情 `/datasets/[id]`

**布局**：信息卡片 + 数据表格

**信息卡片**：
- 名称、描述、行数、创建时间
- 编辑按钮（修改名称描述）
- 导出按钮
- 删除按钮

**数据表格**：
- 动态列（根据 schema 生成）
- 可编辑单元格（双击编辑）
- 新增行按钮
- 删除行按钮
- 分页：每页 50 条

---

### 3.7 模型配置 `/models`

**布局**：提供商分组 + 模型卡片

```
┌─────────────────────────────────────────────────────────────────┐
│ [添加提供商]                                                    │
├─────────────────────────────────────────────────────────────────┤
│ OpenAI                                                   [编辑] │
│ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐                │
│ │ gpt-4o      │ │ gpt-4o-mini │ │ + 添加模型  │                │
│ │ ✓ 已连接    │ │ ✓ 已连接    │ │             │                │
│ └─────────────┘ └─────────────┘ └─────────────┘                │
├─────────────────────────────────────────────────────────────────┤
│ Anthropic                                                [编辑] │
│ ┌─────────────┐ ┌─────────────┐                                │
│ │ claude-3.5  │ │ + 添加模型  │                                │
│ │ ✓ 已连接    │ │             │                                │
│ └─────────────┘ └─────────────┘                                │
└─────────────────────────────────────────────────────────────────┘
```

**添加提供商弹窗**：

| 字段 | 类型 | 必填 |
|------|------|------|
| 名称 | text | 是 |
| 类型 | select (openai/anthropic/azure/custom) | 是 |
| Base URL | url | 是 |
| API Key | password | 是 |
| 自定义请求头 | key-value 列表 | 否 |

**添加模型弹窗**：

| 字段 | 类型 | 必填 |
|------|------|------|
| 显示名称 | text | 是 |
| 模型 ID | text | 是 |
| 默认 Temperature | number (0-2) | 否 |
| 默认 Max Tokens | number | 否 |

**测试连接**：点击后调用模型，显示成功/失败

---

### 3.8 评估器列表 `/evaluators`

**布局**：Tabs + 表格

**Tabs**：
- 预置评估器（只读展示）
- 自定义评估器（可增删改）

**预置评估器展示**：

| 名称 | 说明 |
|------|------|
| 精确匹配 | 输出与期望完全一致 |
| 包含匹配 | 输出包含期望内容 |
| 正则匹配 | 输出匹配正则表达式 |
| JSON Schema | 输出符合 JSON Schema |
| 相似度 | 文本相似度超过阈值 |

**自定义评估器表格列**：

| 列名 | 字段 | 宽度 |
|------|------|------|
| 名称 | name | 200px |
| 类型 | type (code/llm/composite) | 100px |
| 语言 | language (nodejs/python) | 100px |
| 更新时间 | updatedAt | 180px |
| 操作 | - | 120px |

---

### 3.9 评估器编辑 `/evaluators/[id]`

**布局**：配置表单 + 代码编辑器

```
┌─────────────────────────────────────────────────────────────────┐
│ [返回] 评估器名称                                     [保存]    │
├─────────────────────────────────────────────────────────────────┤
│ 基本信息                                                        │
│ 名称: [________________]  类型: [代码 ▼]  语言: [Node.js ▼]    │
│ 描述: [________________________________________________]        │
├─────────────────────────────────────────────────────────────────┤
│ 输入参数                                                        │
│ ┌──────────┬──────────┬──────────────────────────────────────┐ │
│ │ 参数名    │ 类型     │ 说明                                 │ │
│ ├──────────┼──────────┼──────────────────────────────────────┤ │
│ │ input    │ string   │ 原始输入                             │ │
│ │ output   │ string   │ 模型输出                             │ │
│ │ expected │ string   │ 期望输出                             │ │
│ │ metadata │ object   │ 额外数据                             │ │
│ └──────────┴──────────┴──────────────────────────────────────┘ │
├─────────────────────────────────────────────────────────────────┤
│ 代码                                                            │
│ ┌─────────────────────────────────────────────────────────────┐ │
│ │ // 返回格式: { passed: boolean, score?: number, reason? }  │ │
│ │ module.exports = async function(input, output, expected) { │ │
│ │   return {                                                  │ │
│ │     passed: output.includes(expected),                      │ │
│ │     score: 1.0,                                             │ │
│ │     reason: '包含期望内容'                                   │ │
│ │   };                                                        │ │
│ │ }                                                           │ │
│ └─────────────────────────────────────────────────────────────┘ │
├─────────────────────────────────────────────────────────────────┤
│ 测试运行                                                        │
│ input: [________]  output: [________]  expected: [________]    │
│ [运行测试]                                                      │
│ 结果: ✓ passed=true, score=1.0                                 │
└─────────────────────────────────────────────────────────────────┘
```

**代码模板（Node.js）**：

```javascript
/**
 * 评估函数
 * @param {string} input - 原始输入
 * @param {string} output - 模型输出
 * @param {string} expected - 期望输出
 * @param {object} metadata - 额外数据
 * @returns {Promise<{passed: boolean, score?: number, reason?: string}>}
 */
module.exports = async function evaluate(input, output, expected, metadata) {
  // 在此编写评估逻辑
  
  return {
    passed: true,
    score: 1.0,
    reason: '评估通过'
  };
};
```

---

### 3.10 任务列表 `/tasks`

**布局**：筛选栏 + 表格

**筛选栏**：
- 状态筛选（全部/待执行/执行中/已完成/失败）
- 时间范围
- 搜索（任务名称）

**表格列**：

| 列名 | 字段 | 宽度 |
|------|------|------|
| 任务名称 | name | 200px |
| 状态 | status | 100px |
| 进度 | progress | 150px |
| 通过率 | passRate | 100px |
| 创建时间 | createdAt | 180px |
| 操作 | - | 200px |

**状态标签颜色**：
- pending: 灰色
- running: 蓝色
- completed: 绿色
- failed: 红色
- stopped: 橙色

**操作列**：
- 查看详情
- 重跑（仅 completed/failed）
- 终止（仅 running）
- 删除（二次确认）

---

### 3.11 创建任务 `/tasks/new`

**布局**：步骤表单

**步骤 1：基本信息**

| 字段 | 类型 | 必填 |
|------|------|------|
| 任务名称 | text | 是 |
| 描述 | textarea | 否 |

**步骤 2：测试配置**

| 字段 | 类型 | 必填 |
|------|------|------|
| 提示词 | select（支持多选） | 是 |
| 提示词版本 | select | 是（每个提示词选一个版本） |
| 模型 | select（支持多选） | 是 |
| 数据集 | select | 是 |

**步骤 3：评估配置**

| 字段 | 类型 | 必填 |
|------|------|------|
| 评估器 | select（支持多选） | 是 |

**步骤 4：执行配置**

| 字段 | 类型 | 默认值 |
|------|------|--------|
| 并发数 | number | 5 |
| 超时时间(秒) | number | 30 |
| 重试次数 | number | 3 |

**确认页**：汇总所有配置，显示预估数据量

---

### 3.12 任务详情 `/tasks/[id]`

**布局**：概览卡片 + 结果表格

**概览卡片**：
- 任务状态、进度条
- 统计数据：总数、通过、失败、通过率、平均耗时
- 操作按钮：重跑、导出

**结果表格列**：

| 列名 | 字段 | 宽度 |
|------|------|------|
| 序号 | index | 80px |
| 输入摘要 | input (截断) | 200px |
| 输出摘要 | output (截断) | 200px |
| 状态 | status | 100px |
| 评估结果 | passed | 100px |
| 耗时 | latency | 100px |
| 操作 | - | 80px |

**筛选**：
- 状态（成功/失败/超时）
- 评估结果（通过/未通过）

**详情抽屉**（点击行展开）：
- 完整输入
- 完整输出
- 期望输出
- 各评估器结果详情
- Token 消耗

---

## 四、通用交互规范

### 4.1 加载状态

- 表格：使用 Spin 覆盖
- 按钮：使用 loading 属性
- 页面：使用骨架屏

### 4.2 错误处理

- API 错误：Toast 提示
- 表单校验：字段下方红色提示
- 网络错误：全局错误提示

### 4.3 确认操作

以下操作需要二次确认：
- 删除任何资源
- 回滚版本
- 终止任务

### 4.4 空状态

每个列表页需要空状态插图和引导操作：
- 提示词列表空：显示"创建第一个提示词"
- 数据集列表空：显示"上传数据集"
- 任务列表空：显示"创建测试任务"

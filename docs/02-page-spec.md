# 页面规格说明

## 一、页面清单

| 路由 | 页面名称 | 优先级 | 说明 |
|------|----------|--------|------|
| `/login` | 登录页 | MVP | 用户认证入口 |
| `/` | 工作台 | MVP | 统计概览、快速开始、最近任务 |
| `/prompts` | 提示词列表 | MVP | 提示词管理、版本控制 |
| `/prompts/[id]` | 提示词详情/编辑 | MVP | 编辑器、版本历史、快速测试 |
| `/prompts/compare` | 提示词版本对比 | V3 | 版本 Diff、效果对比分析 |
| `/datasets` | 数据集列表 | MVP | 数据集管理、上传预览 |
| `/datasets/[id]` | 数据集详情 | MVP | 数据预览、在线编辑 |
| `/models` | 模型配置 | MVP | 提供商管理、模型配置 |
| `/models/compare` | 模型对比分析 | V3 | 多模型性能对比 |
| `/evaluators` | 评估器列表 | MVP | 预置+自定义评估器 |
| `/evaluators/[id]` | 评估器编辑 | MVP | 代码编辑、测试运行 |
| `/tasks` | 任务列表 | MVP | 任务管理、状态筛选 |
| `/tasks/new` | 创建任务 | MVP | 步骤表单、配置向导 |
| `/tasks/[id]` | 任务详情/结果 | MVP | 结果分析、失败样本聚类 |
| `/tasks/[id]/analysis` | 智能分析 | V3 | AI 驱动的问题模式识别 |
| `/monitor` | 监控中心 | V2 | 定时任务、趋势图表、告警 |
| `/settings` | 系统设置 | V2 | 项目管理、成员管理、通知配置 |
| `/onboarding` | 新用户引导 | V3 | 3步引导向导 |
| `/prompts/[id]/regression` | 回归测试追踪 | V3 | 版本趋势、回归检测 |
| `/templates` | 任务模板 | V3 | 模板管理、快速创建 |

---

## 二、布局结构

### 2.1 整体布局

```
┌─────────────────────────────────────────────────────────────────────────┐
│ Header (56px)                                              用户 ▼       │
├──────────┬──────────────────────────────────────────────────────────────┤
│          │                                                              │
│  Sidebar │  Content Area                                                │
│  (240px) │                                                              │
│          │  ┌────────────────────────────────────────────────────────┐ │
│  可折叠   │  │ PageContainer                                          │ │
│  收起80px │  │ padding: 24px                                          │ │
│          │  │                                                         │ │
│  - 工作台 │  │  ┌──────────────────────────────────────────────────┐  │ │
│  - 提示词 │  │  │ Card                                              │  │ │
│  - 数据集 │  │  │ padding: 24px                                     │  │ │
│  - 模型   │  │  │ margin-bottom: 24px                               │  │ │
│  - 评估器 │  │  │ border-radius: 12px                               │  │ │
│  - 任务   │  │  └──────────────────────────────────────────────────┘  │ │
│  - 监控   │  │                                                         │ │
│  ─────── │  └────────────────────────────────────────────────────────┘ │
│  - 设置   │                                                              │
│          │                                                              │
└──────────┴──────────────────────────────────────────────────────────────┘
```

### 2.2 响应式断点

| 断点 | 宽度 | 侧边栏 | 内容区 | 卡片列数 |
|------|------|--------|--------|----------|
| xs | < 576px | 隐藏（抽屉） | 100% | 1 |
| sm | 576px - 768px | 隐藏（抽屉） | 100% | 1 |
| md | 768px - 1024px | 收起（80px） | calc(100% - 80px) | 2 |
| lg | 1024px - 1280px | 展开（240px） | calc(100% - 240px) | 3 |
| xl | > 1280px | 展开（240px） | calc(100% - 240px) | 4 |

### 2.3 布局组件

使用 Ant Design Pro Layout：

```tsx
// 使用 ProLayout 组件
import { ProLayout } from '@ant-design/pro-components';
```

---

## 三、各页面详细规格

### 3.1 登录页 `/login`

**布局**：居中卡片，无侧边栏

**表单字段**：

| 字段 | 类型 | 必填 | 校验 |
|------|------|------|------|
| 邮箱 | email | 是 | 邮箱格式 |
| 密码 | password | 是 | 最少6位 |

**交互**：
- 登录成功跳转 `/`
- 登录失败显示错误提示

---

### 3.2 工作台 `/`

**布局**：欢迎区 + 统计卡片 + 快速开始 + 最近任务 + 执行趋势

```
┌─────────────────────────────────────────────────────────────────────────────┐
│  工作台                                                                     │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌──────────────────────────────────────────────────────────────────────┐   │
│  │  👋 欢迎回来，Admin                                                   │   │
│  │  你有 2 个任务正在执行，1 条告警需要关注                              │   │
│  │                                                    [查看详情 →]       │   │
│  └──────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│  ┌────────────┐ ┌────────────┐ ┌────────────┐ ┌────────────┐              │
│  │ 📝 提示词   │ │ 📊 数据集   │ │ ⚡ 本周任务  │ │ ✅ 通过率   │              │
│  │     12     │ │     8      │ │    25      │ │   85.6%    │              │
│  │   ↑ 2 本周 │ │   ↑ 1 本周 │ │   ↑ 8      │ │   ↑ 2.3%   │              │
│  └────────────┘ └────────────┘ └────────────┘ └────────────┘              │
│                                                                             │
│  ┌─────────────────────────────────┐  ┌──────────────────────────────────┐ │
│  │ 🚀 快速开始                      │  │ 📌 最近任务                       │ │
│  │                                 │  │                                  │ │
│  │  ┌────────────────────────────┐ │  │  ┌──────────────────────────┐   │ │
│  │  │ + 新建测试任务              │ │  │  │ GPT-4 提示词测试    ✅   │   │ │
│  │  │   选择提示词、模型、数据集   │ │  │  │ 5分钟前 · 通过率 95%    │   │ │
│  │  └────────────────────────────┘ │  │  └──────────────────────────┘   │ │
│  │                                 │  │                                  │ │
│  │  ┌───────┐ ┌───────┐ ┌───────┐ │  │  ┌──────────────────────────┐   │ │
│  │  │📝新建 │ │📊上传 │ │🔧配置 │ │  │  │ 分类模型评估       🔄   │   │ │
│  │  │提示词 │ │数据集 │ │模型  │ │  │  │ 执行中 · 45/100         │   │ │
│  │  └───────┘ └───────┘ └───────┘ │  │  └──────────────────────────┘   │ │
│  │                                 │  │                                  │ │
│  └─────────────────────────────────┘  │          [查看全部 →]            │ │
│                                       └──────────────────────────────────┘ │
│                                                                             │
│  ┌──────────────────────────────────────────────────────────────────────┐   │
│  │ 📈 执行趋势                                           7天 | 30天     │   │
│  │   100 ┤                              ╭──●                            │   │
│  │    75 ┤               ╭──●───────────╯                               │   │
│  │    50 ┤ ●─────────────╯                                              │   │
│  │    25 ┤                                                              │   │
│  │     0 └───────────────────────────────────────────────               │   │
│  │   ● 执行数 ── ● 通过数 ── ● 失败数                                    │   │
│  └──────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

**区块说明**：

| 区块 | 内容 | 组件 |
|------|------|------|
| 欢迎区 | 用户名、待处理事项提示 | 自定义卡片 |
| 统计卡片（4个） | 提示词数量、数据集数量、本周任务数、成功率 | StatCard 组件 |
| 快速开始 | 新建任务入口 + 快捷操作（新建提示词、上传数据集、配置模型） | ActionCard |
| 最近任务 | 最近 5 个任务，状态、时间、进度、快捷操作 | 任务列表卡片 |
| 执行趋势 | 7天/30天趋势图表 | Recharts 折线图 |

**StatCard 组件规格**：

```tsx
type StatCardProps = {
  icon: ReactNode;
  iconBg: 'primary' | 'success' | 'warning' | 'info';
  title: string;
  value: number | string;
  suffix?: string;
  trend?: { value: number; type: 'up' | 'down'; label?: string };
  onClick?: () => void;
};
```

**数据刷新**：进入页面时获取，执行中任务自动刷新（5秒间隔）

---

### 3.3 提示词列表 `/prompts`

**布局**：工具栏 + 表格

**工具栏**：
- 搜索框（按名称搜索）
- 新建按钮

**表格列**：

| 列名 | 字段 | 宽度 | 排序 |
|------|------|------|------|
| 名称 | name | 200px | 否 |
| 描述 | description | auto | 否 |
| 当前版本 | currentVersion | 100px | 否 |
| 更新时间 | updatedAt | 180px | 是 |
| 操作 | - | 150px | 否 |

**操作列**：
- 编辑：跳转详情页
- 快速测试：打开抽屉
- 删除：二次确认

**分页**：每页 20 条

---

### 3.4 提示词详情 `/prompts/[id]`

**布局**：左右分栏

```
┌─────────────────────────────────────────────────────────────────┐
│ [返回] 提示词名称                            [保存草稿] [发布]  │
├────────────────────────────────┬────────────────────────────────┤
│                                │                                │
│         编辑器区域              │           侧边栏               │
│                                │                                │
│  ┌──────────────────────────┐  │  ┌──────────────────────────┐  │
│  │                          │  │  │ 版本历史                 │  │
│  │     Monaco Editor        │  │  │ - v3 (当前) 2024-01-15  │  │
│  │                          │  │  │ - v2 2024-01-10         │  │
│  │                          │  │  │ - v1 2024-01-05         │  │
│  │                          │  │  └──────────────────────────┘  │
│  └──────────────────────────┘  │                                │
│                                │  ┌──────────────────────────┐  │
│  变量列表：                     │  │ 快速测试                 │  │
│  - role (string)               │  │ 模型: [选择 ▼]           │  │
│  - question (string)           │  │ 变量输入...              │  │
│                                │  │ [运行测试]               │  │
│                                │  └──────────────────────────┘  │
└────────────────────────────────┴────────────────────────────────┘
```

**编辑器区域**：
- Monaco Editor，语言设为 `markdown` 或 `plaintext`
- 高亮 `{{变量}}` 语法
- 自动提取变量列表

**版本历史**：
- 点击版本号查看内容（只读）
- 对比按钮：选择两个版本对比
- 回滚按钮：确认后回滚

**快速测试**：
- 选择模型
- 填写变量值
- 运行并显示结果

**按钮逻辑**：
- 保存草稿：保存到 `content` 字段，不创建版本
- 发布：创建新版本，需填写变更说明

---

### 3.5 数据集列表 `/datasets`

**布局**：工具栏 + 表格

**工具栏**：
- 搜索框
- 下载模板（下拉：基础模板、带期望输出模板）
- 上传数据集

**表格列**：

| 列名 | 字段 | 宽度 |
|------|------|------|
| 名称 | name | 200px |
| 描述 | description | auto |
| 行数 | rowCount | 100px |
| 存储方式 | isPersistent | 100px |
| 更新时间 | updatedAt | 180px |
| 操作 | - | 120px |

**上传流程**：
1. 选择文件（xlsx/csv）
2. 解析预览（显示前 5 行）
3. 字段映射（自动识别 input/expected）
4. 选择存储方式（临时/持久化）
5. 确认上传

---

### 3.6 数据集详情 `/datasets/[id]`

**布局**：信息卡片 + 数据表格

**信息卡片**：
- 名称、描述、行数、创建时间
- 编辑按钮（修改名称描述）
- 导出按钮
- 删除按钮

**数据表格**：
- 动态列（根据 schema 生成）
- 可编辑单元格（双击编辑）
- 新增行按钮
- 删除行按钮
- 分页：每页 50 条

---

### 3.7 模型配置 `/models`

**布局**：提供商分组 + 模型卡片

```
┌─────────────────────────────────────────────────────────────────┐
│ [添加提供商]                                                    │
├─────────────────────────────────────────────────────────────────┤
│ OpenAI                                                   [编辑] │
│ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐                │
│ │ gpt-4o      │ │ gpt-4o-mini │ │ + 添加模型  │                │
│ │ ✓ 已连接    │ │ ✓ 已连接    │ │             │                │
│ └─────────────┘ └─────────────┘ └─────────────┘                │
├─────────────────────────────────────────────────────────────────┤
│ Anthropic                                                [编辑] │
│ ┌─────────────┐ ┌─────────────┐                                │
│ │ claude-3.5  │ │ + 添加模型  │                                │
│ │ ✓ 已连接    │ │             │                                │
│ └─────────────┘ └─────────────┘                                │
└─────────────────────────────────────────────────────────────────┘
```

**添加提供商弹窗**：

| 字段 | 类型 | 必填 |
|------|------|------|
| 名称 | text | 是 |
| 类型 | select (openai/anthropic/azure/custom) | 是 |
| Base URL | url | 是 |
| API Key | password | 是 |
| 自定义请求头 | key-value 列表 | 否 |

**添加模型弹窗**：

| 字段 | 类型 | 必填 |
|------|------|------|
| 显示名称 | text | 是 |
| 模型 ID | text | 是 |
| 默认 Temperature | number (0-2) | 否 |
| 默认 Max Tokens | number | 否 |

**测试连接**：点击后调用模型，显示成功/失败

---

### 3.8 评估器列表 `/evaluators`

**布局**：Tabs + 表格

**Tabs**：
- 预置评估器（只读展示）
- 自定义评估器（可增删改）

**预置评估器展示**：

| 名称 | 说明 |
|------|------|
| 精确匹配 | 输出与期望完全一致 |
| 包含匹配 | 输出包含期望内容 |
| 正则匹配 | 输出匹配正则表达式 |
| JSON Schema | 输出符合 JSON Schema |
| 相似度 | 文本相似度超过阈值 |

**自定义评估器表格列**：

| 列名 | 字段 | 宽度 |
|------|------|------|
| 名称 | name | 200px |
| 类型 | type (code/llm/composite) | 100px |
| 语言 | language (nodejs/python) | 100px |
| 更新时间 | updatedAt | 180px |
| 操作 | - | 120px |

---

### 3.9 评估器编辑 `/evaluators/[id]`

**布局**：配置表单 + 代码编辑器

```
┌─────────────────────────────────────────────────────────────────┐
│ [返回] 评估器名称                                     [保存]    │
├─────────────────────────────────────────────────────────────────┤
│ 基本信息                                                        │
│ 名称: [________________]  类型: [代码 ▼]  语言: [Node.js ▼]    │
│ 描述: [________________________________________________]        │
├─────────────────────────────────────────────────────────────────┤
│ 输入参数                                                        │
│ ┌──────────┬──────────┬──────────────────────────────────────┐ │
│ │ 参数名    │ 类型     │ 说明                                 │ │
│ ├──────────┼──────────┼──────────────────────────────────────┤ │
│ │ input    │ string   │ 原始输入                             │ │
│ │ output   │ string   │ 模型输出                             │ │
│ │ expected │ string   │ 期望输出                             │ │
│ │ metadata │ object   │ 额外数据                             │ │
│ └──────────┴──────────┴──────────────────────────────────────┘ │
├─────────────────────────────────────────────────────────────────┤
│ 代码                                                            │
│ ┌─────────────────────────────────────────────────────────────┐ │
│ │ // 返回格式: { passed: boolean, score?: number, reason? }  │ │
│ │ module.exports = async function(input, output, expected) { │ │
│ │   return {                                                  │ │
│ │     passed: output.includes(expected),                      │ │
│ │     score: 1.0,                                             │ │
│ │     reason: '包含期望内容'                                   │ │
│ │   };                                                        │ │
│ │ }                                                           │ │
│ └─────────────────────────────────────────────────────────────┘ │
├─────────────────────────────────────────────────────────────────┤
│ 测试运行                                                        │
│ input: [________]  output: [________]  expected: [________]    │
│ [运行测试]                                                      │
│ 结果: ✓ passed=true, score=1.0                                 │
└─────────────────────────────────────────────────────────────────┘
```

**代码模板（Node.js）**：

```javascript
/**
 * 评估函数
 * @param {string} input - 原始输入
 * @param {string} output - 模型输出
 * @param {string} expected - 期望输出
 * @param {object} metadata - 额外数据
 * @returns {Promise<{passed: boolean, score?: number, reason?: string}>}
 */
module.exports = async function evaluate(input, output, expected, metadata) {
  // 在此编写评估逻辑
  
  return {
    passed: true,
    score: 1.0,
    reason: '评估通过'
  };
};
```

---

### 3.10 任务列表 `/tasks`

**布局**：筛选栏 + 表格

**筛选栏**：
- 状态筛选（全部/待执行/执行中/已完成/失败）
- 时间范围
- 搜索（任务名称）

**表格列**：

| 列名 | 字段 | 宽度 |
|------|------|------|
| 任务名称 | name | 200px |
| 状态 | status | 100px |
| 进度 | progress | 150px |
| 通过率 | passRate | 100px |
| 创建时间 | createdAt | 180px |
| 操作 | - | 200px |

**状态标签颜色**：
- pending: 灰色
- running: 蓝色
- completed: 绿色
- failed: 红色
- stopped: 橙色

**操作列**：
- 查看详情
- 重跑（仅 completed/failed）
- 终止（仅 running）
- 删除（二次确认）

---

### 3.11 创建任务 `/tasks/new`

**布局**：步骤表单

**步骤 1：基本信息**

| 字段 | 类型 | 必填 |
|------|------|------|
| 任务名称 | text | 是 |
| 描述 | textarea | 否 |

**步骤 2：测试配置**

| 字段 | 类型 | 必填 |
|------|------|------|
| 提示词 | select（支持多选） | 是 |
| 提示词版本 | select | 是（每个提示词选一个版本） |
| 模型 | select（支持多选） | 是 |
| 数据集 | select | 是 |

**步骤 3：评估配置**

| 字段 | 类型 | 必填 |
|------|------|------|
| 评估器 | select（支持多选） | 是 |

**步骤 4：执行配置**

| 字段 | 类型 | 默认值 |
|------|------|--------|
| 并发数 | number | 5 |
| 超时时间(秒) | number | 30 |
| 重试次数 | number | 3 |

**确认页**：汇总所有配置，显示预估数据量

---

### 3.12 任务详情 `/tasks/[id]`

**布局**：概览卡片 + Tabs（结果/分析/成本）

```
┌─────────────────────────────────────────────────────────────────────────┐
│  ← 返回   任务名称                                    [重跑] [导出]     │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │ 状态: ✅ 已完成    进度: ████████████████████ 100%              │   │
│  │                                                                  │   │
│  │ ┌────────┐ ┌────────┐ ┌────────┐ ┌────────┐ ┌────────┐         │   │
│  │ │ 总数   │ │ 通过   │ │ 失败   │ │ 通过率  │ │ 平均耗时│         │   │
│  │ │ 100    │ │ 75     │ │ 25     │ │ 75%    │ │ 1.2s   │         │   │
│  │ └────────┘ └────────┘ └────────┘ └────────┘ └────────┘         │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  [结果列表] [智能分析] [成本统计]                                        │
│  ─────────────────────────────────────────────────────────────────────  │
│                                                                         │
│  筛选: [状态 ▼] [评估结果 ▼] 🔍 搜索...                                 │
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │ # │ 输入摘要        │ 输出摘要        │ 状态 │ 评估 │ 耗时  │ 操作│   │
│  ├─────────────────────────────────────────────────────────────────┤   │
│  │ 1 │ 请介绍产品...    │ 我们的产品...    │ ✓   │ ✓   │ 1.2s │ 详情│   │
│  │ 2 │ 如何退款...      │ 退款流程...      │ ✓   │ ✗   │ 0.8s │ 详情│   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

**概览卡片**：
- 任务状态、进度条
- 统计数据：总数、通过、失败、通过率、平均耗时
- 操作按钮：重跑、导出

**Tabs**：
1. **结果列表**：测试结果表格
2. **智能分析**：AI 驱动的失败模式分析（V3）
3. **成本统计**：Token 消耗和成本明细（V2）

**结果表格列**：

| 列名 | 字段 | 宽度 |
|------|------|------|
| 序号 | index | 80px |
| 输入摘要 | input (截断) | 200px |
| 输出摘要 | output (截断) | 200px |
| 状态 | status | 100px |
| 评估结果 | passed | 100px |
| 耗时 | latency | 100px |
| 操作 | - | 80px |

**筛选**：
- 状态（成功/失败/超时）
- 评估结果（通过/未通过）

**详情抽屉**（点击行展开）：
- 完整输入
- 完整输出
- 期望输出
- 各评估器结果详情
- Token 消耗

---

### 3.13 智能分析 `/tasks/[id]/analysis` (V3)

**布局**：分析摘要 + 失败模式聚类 + 优化建议

```
┌─────────────────────────────────────────────────────────────────────────┐
│  🧠 智能分析                                              任务 #1234   │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │ 📋 测试摘要                                                      │   │
│  │                                                                  │   │
│  │ 本次测试共 100 条，通过 75 条，失败 25 条                        │   │
│  │                                                                  │   │
│  │ 🔍 AI 发现的问题模式：                                           │   │
│  │                                                                  │   │
│  │ ┌────────────────────────────────────────────────────────────┐  │   │
│  │ │ 问题1: JSON 格式输出不稳定                           12次  │  │   │
│  │ │ 典型案例: 期望 {"name": "xxx"} 实际输出纯文本             │  │   │
│  │ │ 💡 建议: 在提示词中增加 "请严格按照JSON格式输出"          │  │   │
│  │ │                                        [应用建议] [忽略]   │  │   │
│  │ └────────────────────────────────────────────────────────────┘  │   │
│  │                                                                  │   │
│  │ ┌────────────────────────────────────────────────────────────┐  │   │
│  │ │ 问题2: 特定类型问题回答不完整                         8次  │  │   │
│  │ │ 典型案例: 涉及"退款政策"的问题回答缺少关键信息           │  │   │
│  │ │ 💡 建议: 考虑在提示词中补充退款政策的具体条款            │  │   │
│  │ │                                        [应用建议] [忽略]   │  │   │
│  │ └────────────────────────────────────────────────────────────┘  │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │ 失败原因分布                                                     │   │
│  │                                                                  │   │
│  │  格式错误        ████████████████░░░░░░░░ 48%  (12/25)          │   │
│  │  内容不完整      ████████░░░░░░░░░░░░░░░░ 32%  (8/25)           │   │
│  │  关键词缺失      █████░░░░░░░░░░░░░░░░░░░ 20%  (5/25)           │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │ 🎯 优化建议汇总                                                  │   │
│  │                                                                  │   │
│  │ 根据本次测试结果，建议对提示词做以下调整：                       │   │
│  │ 1. 增加输出格式约束                                             │   │
│  │ 2. 补充领域知识（退款政策）                                     │   │
│  │ 3. 增加回答完整性要求                                           │   │
│  │                                                                  │   │
│  │ 预计可将通过率提升至 ~90%                                       │   │
│  │                                                                  │   │
│  │                    [一键应用所有建议] [逐个查看]                 │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

**功能说明**：
- 失败模式自动聚类
- 问题原因智能识别
- 优化建议生成
- 一键应用建议到提示词

---

### 3.14 提示词版本对比 `/prompts/compare` (V3)

**布局**：版本选择器 + 并排对比 + 效果分析

```
┌─────────────────────────────────────────────────────────────────────────┐
│  📊 版本对比分析                                     v2 vs v3          │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ┌───────────────────────────┐  ┌───────────────────────────┐          │
│  │ v2 (上一版本)             │  │ v3 (当前版本)             │          │
│  ├───────────────────────────┤  ├───────────────────────────┤          │
│  │ 通过率: 82%               │  │ 通过率: 91% ↑9%          │          │
│  │ 平均耗时: 2.3s            │  │ 平均耗时: 2.1s ↓0.2s     │          │
│  │ Token消耗: 450            │  │ Token消耗: 380 ↓15%      │          │
│  └───────────────────────────┘  └───────────────────────────┘          │
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │ 提示词差异 (Diff 视图)                                           │   │
│  │                                                                  │   │
│  │  你是一个客服助手...                                            │   │
│  │                                                                  │   │
│  │ - 请用中文回答用户问题                                          │   │
│  │ + 请用简洁的中文回答用户问题，回答控制在100字以内                │   │
│  │                                                                  │   │
│  │ + 回答格式要求：                                                │   │
│  │ + 1. 先给出直接答案                                             │   │
│  │ + 2. 再补充必要说明                                             │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │ 效果变化分析                                                     │   │
│  │                                                                  │   │
│  │ ✅ 改进项：                                                      │   │
│  │    • "输出过长"问题减少 85%                                     │   │
│  │    • 格式一致性提升                                             │   │
│  │                                                                  │   │
│  │ ⚠️ 潜在风险：                                                    │   │
│  │    • 有 3 个复杂问题的回答可能过于简短                          │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  结论：v3 整体表现更好，建议发布                                        │
│                                                 [发布 v3] [继续优化]    │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

### 3.15 新用户引导 `/onboarding` (V3)

**布局**：居中卡片，3步引导向导

```
┌──────────────────────────────────────────────────────────────────────┐
│  👋 欢迎使用 AI 测试平台                                              │
│                                                                      │
│  让我们用 3 分钟完成初始设置：                                        │
│                                                                      │
│  ① 配置你的第一个模型 ─────────────────────────────────── [2分钟]    │
│     连接 OpenAI / Claude / 自定义模型                                │
│                                                                      │
│  ② 创建你的第一个提示词 ───────────────────────────────── [30秒]    │
│     可以从模板开始，或粘贴现有提示词                                  │
│                                                                      │
│  ③ 运行一个快速测试 ───────────────────────────────────── [30秒]    │
│     验证一切正常工作                                                  │
│                                                                      │
│                                              [开始设置 →]            │
└──────────────────────────────────────────────────────────────────────┘
```

**引导步骤**：
1. **配置模型**：选择提供商、输入 API Key、测试连接
2. **创建提示词**：选择模板或粘贴现有提示词、提取变量
3. **运行测试**：输入测试数据、执行快速测试、查看结果

**完成后**：跳转到工作台，显示成功提示

---

## 四、通用交互规范

### 4.1 加载状态

- 表格：使用 Spin 覆盖
- 按钮：使用 loading 属性
- 页面：使用骨架屏

### 4.2 错误处理

- API 错误：Toast 提示
- 表单校验：字段下方红色提示
- 网络错误：全局错误提示

### 4.3 确认操作

以下操作需要二次确认：
- 删除任何资源
- 回滚版本
- 终止任务

### 4.4 空状态

每个列表页需要空状态插图和引导操作：
- 提示词列表空：显示"创建第一个提示词"
- 数据集列表空：显示"上传数据集"
- 任务列表空：显示"创建测试任务"

### 4.5 全局搜索 (Cmd/Ctrl + K)

```
┌─────────────────────────────────────────────────────────────────────────┐
│  🔍 输入命令或搜索...                                          ⌘K     │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  最近使用                                                               │
│  ─────────────────────────────────────────────────────────────────────  │
│  📝 GPT-4 客服提示词                                    提示词          │
│  ⚡ 分类模型测试任务                                    任务           │
│  📊 客服对话数据集                                      数据集          │
│                                                                         │
│  快捷操作                                                               │
│  ─────────────────────────────────────────────────────────────────────  │
│  ➕ 新建测试任务                                         ⌘N            │
│  📤 上传数据集                                           ⌘U            │
│  🔄 刷新当前页面                                         ⌘R            │
│                                                                         │
│  导航                                                                   │
│  ─────────────────────────────────────────────────────────────────────  │
│  → 前往工作台                                            G → H         │
│  → 前往提示词管理                                        G → P         │
│  → 前往任务列表                                          G → T         │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 4.6 快捷键系统

| 快捷键 | 功能 | 作用域 |
|--------|------|--------|
| `Ctrl/Cmd + K` | 全局搜索/命令面板 | 全局 |
| `Ctrl/Cmd + N` | 新建（根据当前页面） | 全局 |
| `Ctrl/Cmd + S` | 保存 | 编辑页 |
| `Ctrl/Cmd + Enter` | 提交/运行 | 表单/编辑器 |
| `Escape` | 关闭弹窗/取消 | 弹窗 |
| `?` | 显示快捷键帮助 | 全局 |
| `G → H` | 跳转到工作台 | 全局 |
| `G → P` | 跳转到提示词 | 全局 |
| `G → T` | 跳转到任务 | 全局 |
| `G → D` | 跳转到数据集 | 全局 |
| `G → M` | 跳转到模型配置 | 全局 |

### 4.7 操作反馈规范

```tsx
// 成功反馈（轻量）
message.success('保存成功');

// 成功反馈（带操作）
notification.success({
  message: '任务创建成功',
  description: '任务已加入执行队列，预计 2 分钟后开始执行',
  btn: <Button type="link" onClick={() => navigate(`/tasks/${id}`)}>查看任务</Button>,
});

// 错误反馈
notification.error({
  message: '操作失败',
  description: error.message || '请稍后重试',
  duration: 0,  // 需要手动关闭
});

// 确认操作
Modal.confirm({
  title: '确认删除',
  icon: <ExclamationCircleOutlined style={{ color: '#EF4444' }} />,
  content: '删除后不可恢复，确认删除吗？',
  okText: '删除',
  okType: 'danger',
  cancelText: '取消',
});
```

### 4.8 上下文感知提示 (V3)

当检测到用户操作后，显示智能建议：

```
场景：用户刚修改了提示词
┌─────────────────────────────────────────────┐
│ 💡 检测到提示词变更                          │
│                                             │
│ 建议运行测试验证效果：                       │
│ • 使用上次的测试配置 [一键测试]              │
│ • 与上一版本对比 [对比测试]                  │
│                                             │
└─────────────────────────────────────────────┘

场景：测试任务完成
┌─────────────────────────────────────────────┐
│ ✅ 测试完成 - 通过率 75%                     │
│                                             │
│ 📊 发现 3 个常见失败模式                     │
│                                             │
│ [查看分析] [优化提示词] [导出报告]           │
└─────────────────────────────────────────────┘
```

---

## 五、UI/UX 优化规格（V2）

> 基于 design-ui-plan 的页面优化设计

### 5.1 统计卡片组件 (StatCard)

用于工作台和各页面的数据统计展示：

```
┌─────────────────┐
│ 📝              │  ← 图标（带渐变背景）
│ 提示词           │  ← 标题
│     12          │  ← 数值（大字号）
│   ↑ 2 本周      │  ← 趋势指示（可选）
└─────────────────┘
```

**规格**：
- 图标背景：渐变色（按类型区分）
- 卡片悬浮：translateY(-2px) + 阴影增强
- 点击可跳转对应页面

### 5.2 任务卡片布局

任务列表使用卡片化展示替代表格：

```
┌───────────────────────────────────────────────────────────────────┐
│                                                                   │
│  🔵 GPT-4 客服对话测试                                            │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━  │
│                                                                   │
│  状态: ● 执行中                     进度: ███████░░░ 72%          │
│                                                                   │
│  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐              │
│  │ 总数    │  │ 已完成   │  │ 通过    │  │ 失败    │              │
│  │ 100     │  │ 72      │  │ 68      │  │ 4       │              │
│  └─────────┘  └─────────┘  └─────────┘  └─────────┘              │
│                                                                   │
│  预估剩余: 2分钟                [查看详情]  [终止]                │
│                                                                   │
└───────────────────────────────────────────────────────────────────┘
```

**状态颜色映射**：
| 状态 | 颜色 | 图标 |
|------|------|------|
| PENDING | #8c8c8c | ⏳ |
| RUNNING | #1677FF | 🔄 |
| COMPLETED | #52C41A | ✅ |
| FAILED | #FF4D4F | ❌ |
| PAUSED | #FAAD14 | ⏸️ |

### 5.3 提示词列表优化

**批量操作支持**：
```
┌───────────────────────────────────────────────────────────────────────────┐
│  提示词管理                                                                │
├───────────────────────────────────────────────────────────────────────────┤
│                                                                           │
│  ┌───────────────────────────────────────────────────────────────────┐   │
│  │  🔍 搜索提示词名称或内容...          │ [标签筛选 ▼] │ + 新建提示词  │   │
│  └───────────────────────────────────────────────────────────────────┘   │
│                                                                           │
│  ┌───────────────────────────────────────────────────────────────────┐   │
│  │ □ │ 名称              │ 描述           │ 版本 │ 标签   │ 更新时间  │   │
│  ├───────────────────────────────────────────────────────────────────┤   │
│  │ □ │ GPT-4 通用助手    │ 通用对话提示词  │ v3   │ 🟢生产 │ 2分钟前  │   │
│  │   │ ──────────────────────────────────────────────────────────────│   │
│  │   │ 快捷操作: [编辑] [测试] [复制] [删除]                          │   │
│  └───────────────────────────────────────────────────────────────────┘   │
│                                                                           │
│  □ 全选    已选择 0 项    [批量删除] [批量导出]    共 25 项  < 1 2 3 >   │
│                                                                           │
└───────────────────────────────────────────────────────────────────────────┘
```

**标签颜色映射**：
| 标签 | 颜色 |
|------|------|
| 生产 | #52C41A (绿) |
| 测试 | #FAAD14 (黄) |
| 开发 | #1677FF (蓝) |
| 归档 | #8c8c8c (灰) |

### 5.4 数据集上传弹窗

增强的上传体验，包含预览和字段映射：

```
┌─────────────────────────────────────────────────────────────────────────┐
│  上传数据集                                                    [关闭 ×] │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ┌───────────────────────────────────────────────────────────────────┐  │
│  │              ╭──────────────────────────────────╮                 │  │
│  │              │        📁                        │                 │  │
│  │              │   拖拽文件到此处或点击上传        │                 │  │
│  │              │   支持 .xlsx, .csv 格式          │                 │  │
│  │              ╰──────────────────────────────────╯                 │  │
│  │                                                                   │  │
│  │  📥 下载模板: [基础模板] [带期望输出模板]                         │  │
│  └───────────────────────────────────────────────────────────────────┘  │
│                                                                         │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━ 上传后 ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━  │
│                                                                         │
│  📊 数据预览 (共 100 行)                                                │
│  📋 字段映射（自动识别 input/expected）                                 │
│  ⚙️ 存储选项（临时/持久化）                                             │
│                                                                         │
│                                            [取消]  [确认上传]           │
└─────────────────────────────────────────────────────────────────────────┘
```

### 5.5 模型配置分组

按提供商分组展示，增强连接状态可视化：

```
┌───────────────────────────────────────────────────────────────────────────┐
│  模型配置                                              + 添加提供商        │
├───────────────────────────────────────────────────────────────────────────┤
│                                                                           │
│  ┌─────────────────────────────────────────────────────────────────────┐  │
│  │ 🟢 OpenAI                                          [编辑] [测试]    │  │
│  │ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ │  │
│  │ Base URL: https://api.openai.com/v1                                 │  │
│  │ API Key: sk-****************************1234                       │  │
│  │                                                                     │  │
│  │   ┌──────────────┐  ┌──────────────┐  ┌──────────────┐             │  │
│  │   │ gpt-4o       │  │ gpt-4o-mini  │  │ + 添加模型   │             │  │
│  │   │ ✅ 已连接    │  │ ✅ 已连接    │  │              │             │  │
│  │   │ Temp: 0.7    │  │ Temp: 0.7    │  │              │             │  │
│  │   └──────────────┘  └──────────────┘  └──────────────┘             │  │
│  └─────────────────────────────────────────────────────────────────────┘  │
│                                                                           │
│  ┌─────────────────────────────────────────────────────────────────────┐  │
│  │ 🔴 Anthropic (连接失败)                             [编辑] [重试]   │  │
│  │ ⚠️ API Key 已过期，请更新                                           │  │
│  └─────────────────────────────────────────────────────────────────────┘  │
│                                                                           │
└───────────────────────────────────────────────────────────────────────────┘
```

**连接状态颜色**：
| 状态 | 颜色 | 说明 |
|------|------|------|
| 🟢 正常 | #52C41A | 连接成功 |
| 🟡 慢 | #FAAD14 | 延迟 > 2s |
| 🔴 失败 | #FF4D4F | 连接失败 |

### 5.6 评估器展示增强

预置评估器卡片化展示：

```
┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐
│ ✅ 精确匹配      │  │ 🔍 包含匹配     │  │ 📝 正则匹配     │
│                 │  │                 │  │                 │
│ exact_match     │  │ contains        │  │ regex           │
│                 │  │                 │  │                 │
│ 输出与期望值    │  │ 输出包含期望    │  │ 输出匹配正则    │
│ 完全一致        │  │ 内容            │  │ 表达式          │
│                 │  │                 │  │                 │
│ 适用: 分类任务  │  │ 适用: 关键词   │  │ 适用: 格式校验  │
│ ─────────────── │  │ ─────────────── │  │ ─────────────── │
│ [查看详情 →]    │  │ [查看详情 →]    │  │ [查看详情 →]    │
└─────────────────┘  └─────────────────┘  └─────────────────┘
```

**评估器类型图标**：
| 类型 | 图标 | 颜色 |
|------|------|------|
| 精确匹配 | ✅ | #52C41A |
| 包含匹配 | 🔍 | #1677FF |
| 正则匹配 | 📝 | #722ED1 |
| JSON Schema | 📋 | #13C2C2 |
| 相似度 | 📊 | #FA8C16 |
| LLM 评估 | 🤖 | #EB2F96 |
| 代码评估 | 💻 | #2F54EB |
| 组合评估 | 🔗 | #52C41A |

### 5.7 监控中心布局

数据可视化增强：

```
┌─────────────────────────────────────────────────────────────────────────┐
│  🎯 监控中心                                [24h] [7天] [30天] [自定义]  │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ┌──────────────────────────────────────────┐  ┌────────────────────┐   │
│  │ 📊 执行概览                               │  │ 🔔 活跃告警       │   │
│  │                                          │  │                    │   │
│  │  ┌──────┐  ┌──────┐  ┌──────┐  ┌──────┐ │  │  🔴 通过率低于阈值│   │
│  │  │ 256  │  │ 231  │  │ 25   │  │90.2% │ │  │  分类模型评估     │   │
│  │  │ 执行 │  │ 成功 │  │ 失败 │  │通过率│ │  │  5分钟前          │   │
│  │  └──────┘  └──────┘  └──────┘  └──────┘ │  │                    │   │
│  └──────────────────────────────────────────┘  │ [查看全部 →]     │   │
│                                                └────────────────────┘   │
│                                                                         │
│  ┌──────────────────────────────────────────────────────────────────┐  │
│  │ 📈 模型性能对比                                                   │  │
│  │  模型            │ 调用次数 │ 成功率 │ 平均延迟 │ 通过率 │ Token  │  │
│  │  GPT-4o          │ 1,234   │ 99.8% │ 1.2s    │ 94.5% │ 45.2K  │  │
│  │  GPT-4o-mini     │ 2,567   │ 99.9% │ 0.8s    │ 89.2% │ 82.1K  │  │
│  └──────────────────────────────────────────────────────────────────┘  │
│                                                                         │
│  ┌──────────────────────────────────────────────────────────────────┐  │
│  │ 📊 通过率趋势（Recharts 折线图）                                   │  │
│  └──────────────────────────────────────────────────────────────────┘  │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

**告警级别颜色**：
| 级别 | 颜色 | 图标 |
|------|------|------|
| 严重 (Critical) | #FF4D4F | 🔴 |
| 警告 (Warning) | #FAAD14 | 🟡 |
| 信息 (Info) | #1677FF | 🔵 |

### 5.8 全局搜索弹窗

Ctrl/Cmd + K 唤起：

```
┌─────────────────────────────────────────────────────────────────┐
│ 🔍 搜索提示词、数据集、任务...                    Ctrl+K 关闭   │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│ 📝 提示词                                                       │
│   • GPT-4 通用助手                                    v3       │
│   • 分类任务模板                                      v2       │
│                                                                 │
│ 📊 数据集                                                       │
│   • 客服对话测试集                                 1,234行     │
│                                                                 │
│ ⚡ 任务                                                         │
│   • GPT-4 客服对话测试                            执行中       │
│                                                                 │
│ ─────────────────────────────────────────────────────────────  │
│ 💡 输入 > 可执行命令: 新建任务、上传数据集、添加模型...          │
└─────────────────────────────────────────────────────────────────┘
```

### 5.9 设置页面分组

左侧菜单分组 + 右侧卡片化设置项：

```
┌─────────────────────────────────────────────────────────────────────────┐
│  设置                                                                    │
├─────────────────────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌───────────────────────────────────────────────────┐ │
│  │ 个人        │  │ ┌─────────────────────────────────────────────┐   │ │
│  │ ─────────── │  │ │ 基本设置                                     │   │ │
│  │ 👤 个人信息 │  │ │ ───────────────────────────────────────────│   │ │
│  │ 🔐 账号安全 │  │ │ 站点名称: [AI 测试平台]                      │   │ │
│  │ 🔔 通知设置 │  │ │ 默认分页: [20 条/页 ▼]                       │   │ │
│  │ 🔑 API Token│  │ └─────────────────────────────────────────────┘   │ │
│  │             │  │                                                   │ │
│  │ 团队        │  │ ┌─────────────────────────────────────────────┐   │ │
│  │ ─────────── │  │ │ 区域与语言                                   │   │ │
│  │ 👥 团队设置 │  │ │ ───────────────────────────────────────────│   │ │
│  │             │  │ │ 时区: [UTC+8 ▼]    语言: [简体中文 ▼]        │   │ │
│  │ 系统        │  │ └─────────────────────────────────────────────┘   │ │
│  │ ─────────── │  │                                                   │ │
│  │ ⚙️ 通用设置◀│  │                     [重置]  [💾 保存设置]         │ │
│  │ 👤 用户管理 │  │                                                   │ │
│  │ 📋 操作日志 │  └───────────────────────────────────────────────────┘ │
│  └─────────────┘                                                        │
└─────────────────────────────────────────────────────────────────────────┘
```

**保存按钮状态**：
| 状态 | 显示 |
|------|------|
| idle | [💾 保存设置] |
| saving | [保存中...] |
| saved | [✓ 已保存] (2秒后恢复) |
| error | [保存失败] |

---

## 六、深度优化页面规格（V3）

> 基于 product-deep-optimization 的专业深度功能

### 6.1 模型对比分析 `/models/compare`

**布局**：模型选择器 + 对比表格 + 建议卡片

```
┌─────────────────────────────────────────────────────────────────────────┐
│  🤖 模型对比分析                                                        │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  选择对比模型: [GPT-4o ▼] [GPT-4o-mini ▼] [Claude-3.5 ▼]  [+ 添加模型] │
│  选择提示词: [GPT-4 通用助手 ▼]                                         │
│  选择数据集: [客服对话测试集 ▼]                                         │
│                                                [开始对比测试]           │
│                                                                         │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 对比结果 ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━  │
│                                                                         │
│  ┌──────────────────────────────────────────────────────────────────┐  │
│  │                                                                   │  │
│  │  指标          │ GPT-4o    │ GPT-4o-mini │ Claude-3.5  │ 胜出   │  │
│  │  ────────────────────────────────────────────────────────────── │  │
│  │  通过率        │ 94.2%     │ 87.5%       │ 91.8%       │ GPT-4o │  │
│  │  平均延迟      │ 1.8s      │ 0.6s        │ 2.1s        │ mini   │  │
│  │  Token成本     │ $0.045    │ $0.008      │ $0.038      │ mini   │  │
│  │  格式准确率    │ 98%       │ 92%         │ 96%         │ GPT-4o │  │
│  │  复杂问题表现  │ 96%       │ 78%         │ 89%         │ GPT-4o │  │
│  │                                                                   │  │
│  └──────────────────────────────────────────────────────────────────┘  │
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │ 💡 智能建议                                                      │   │
│  │                                                                  │   │
│  │ • 简单问题使用 GPT-4o-mini 可节省 82% 成本                      │   │
│  │ • 复杂问题保留 GPT-4o 确保质量                                  │   │
│  │ • 考虑实现路由策略：根据问题复杂度自动选择模型                   │   │
│  │                                                                  │   │
│  │                            [导出对比报告] [应用建议]             │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

**对比指标**：
| 指标 | 说明 | 排序方式 |
|------|------|----------|
| 通过率 | 评估通过的比例 | 越高越好 |
| 平均延迟 | API 响应时间 | 越低越好 |
| Token成本 | 输入+输出 Token 费用 | 越低越好 |
| 格式准确率 | 输出格式正确的比例 | 越高越好 |
| 复杂问题表现 | 复杂问题的通过率 | 越高越好 |

**胜出高亮**：绿色背景 `#F6FFED`

---

### 6.2 回归测试追踪 `/prompts/[id]/regression`

**布局**：版本时间线 + 趋势图表 + 变更记录

```
┌─────────────────────────────────────────────────────────────────────────┐
│  🔄 回归测试追踪                                          提示词 #123  │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │ 📈 版本通过率趋势                                                │   │
│  │                                                                  │   │
│  │  100% ┤                                         ╭──●            │   │
│  │   90% ┤                              ╭──●───────╯               │   │
│  │   80% ┤               ╭──●───────────╯                          │   │
│  │   70% ┤ ●─────────────╯                                         │   │
│  │   60% ┤                                                         │   │
│  │       └────────────────────────────────────────────────         │   │
│  │         v1          v2          v3          v4         v5       │   │
│  │       (12/01)     (12/03)     (12/05)     (12/08)   (12/10)     │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │ 📋 版本变更记录                                                  │   │
│  │                                                                  │   │
│  │  ● v5 (当前)                                       通过率 94%   │   │
│  │  │ 增加回答长度约束                               2024-12-10   │   │
│  │  │                                                              │   │
│  │  ● v4                                              通过率 91%   │   │
│  │  │ 优化JSON格式输出要求                           2024-12-08   │   │
│  │  │                                                              │   │
│  │  ● v3                                              通过率 85%   │   │
│  │  │ 补充退款政策说明                               2024-12-05   │   │
│  │  │                                                              │   │
│  │  ● v2                                              通过率 78%   │   │
│  │  │ 增加格式要求                                   2024-12-03   │   │
│  │  │                                                              │   │
│  │  ● v1                                              通过率 72%   │   │
│  │    初始版本                                       2024-12-01   │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │ ⚠️ 回归问题检测                                                  │   │
│  │                                                                  │   │
│  │ 未发现回归问题。所有版本的通过率呈上升趋势。                      │   │
│  │                                                                  │   │
│  │ 如果检测到问题：                                                 │   │
│  │ ┌───────────────────────────────────────────────────────────┐   │   │
│  │ │ 🔴 回归警告：v4 → v5 "退款问题"类别通过率下降 12%          │   │   │
│  │ │    可能原因：新增的长度约束影响了退款说明的完整性          │   │   │
│  │ │                        [查看失败样本] [对比版本] [回滚]    │   │   │
│  │ └───────────────────────────────────────────────────────────┘   │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

**趋势图配色**：
- 通过率上升：绿色 `#52C41A`
- 通过率下降：红色 `#FF4D4F`
- 无变化：蓝色 `#1677FF`

**回归检测逻辑**：
- 新版本通过率低于上一版本 5% 以上触发警告
- 特定类别通过率下降 10% 以上触发详细分析

---

### 6.3 失败样本聚类分析

在任务详情的智能分析 Tab 中展示：

```
┌─────────────────────────────────────────────────────────────────────────┐
│  📊 失败样本聚类                                                        │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │ 📁 聚类 1: 格式错误 (12个)                              [展开] │   │
│  │ ───────────────────────────────────────────────────────────────│   │
│  │ 典型样本: "期望JSON但输出了纯文本"                             │   │
│  │ 共同特征: 问题中包含"请列出"、"有哪些"                         │   │
│  │ 💡 建议: 增加 JSON 格式约束示例                               │   │
│  │                                                                │   │
│  │ 展开后显示该聚类下所有失败样本列表                            │   │
│  │ ┌───────────────────────────────────────────────────────────┐ │   │
│  │ │ #3  请列出产品特点...    输出纯文本    [查看详情]          │ │   │
│  │ │ #7  有哪些付款方式...    输出纯文本    [查看详情]          │ │   │
│  │ │ #12 请介绍功能列表...    输出纯文本    [查看详情]          │ │   │
│  │ └───────────────────────────────────────────────────────────┘ │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │ 📁 聚类 2: 内容不完整 (8个)                             [展开] │   │
│  │ ───────────────────────────────────────────────────────────────│   │
│  │ 典型样本: "回答缺少必要的背景说明"                             │   │
│  │ 共同特征: 涉及政策解释类问题                                   │   │
│  │ 💡 建议: 补充相关政策背景知识                                 │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │ 📁 聚类 3: 关键词缺失 (5个)                             [展开] │   │
│  │ ───────────────────────────────────────────────────────────────│   │
│  │ 典型样本: "回答未包含期望关键词"                               │   │
│  │ 共同特征: 涉及特定术语的专业问题                               │   │
│  │ 💡 建议: 增加专业术语的明确要求                               │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│                        [批量应用建议] [导出聚类报告]                   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

**聚类算法参数**：
- 相似度阈值：0.75
- 最小聚类大小：3
- 最大聚类数量：10

---

### 6.4 智能评估器推荐

在创建任务的评估配置步骤中显示：

```
┌─────────────────────────────────────────────────────────────────────────┐
│  选择评估器                                                             │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  🤖 根据你的提示词和数据集，AI 推荐以下评估器组合：                       │
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │ ⭐ 推荐组合（匹配度 95%）                                        │   │
│  │                                                                  │   │
│  │ ☑️ JSON Schema 校验                                             │   │
│  │    检测到提示词要求 JSON 输出                                   │   │
│  │                                                                  │   │
│  │ ☑️ 关键词包含                                                   │   │
│  │    检测到数据集有期望关键词字段                                 │   │
│  │                                                                  │   │
│  │ ☐ 相似度匹配                                                    │   │
│  │    可选，用于模糊匹配场景                                       │   │
│  │                                                                  │   │
│  │                                              [使用推荐] [手动选] │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━ 或手动选择 ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━  │
│                                                                         │
│  预置评估器:                                                            │
│  ☐ 精确匹配  ☐ 包含匹配  ☐ 正则匹配  ☐ JSON Schema  ☐ 相似度          │
│                                                                         │
│  自定义评估器:                                                          │
│  ☐ 业务逻辑校验器  ☐ 分类结果评估器                                    │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

**推荐逻辑**：
| 检测特征 | 推荐评估器 |
|----------|-----------|
| 提示词包含 "JSON"、"格式" | JSON Schema 校验 |
| 数据集有 `expected` 字段 | 精确匹配 或 相似度 |
| 提示词要求包含特定内容 | 关键词包含 |
| 数据集有 `keywords` 字段 | 关键词包含 |
| 分类任务（检测到类别字段） | 精确匹配 |

---

### 6.5 任务配置模板

在任务列表页显示模板入口：

```
┌─────────────────────────────────────────────────────────────────────────┐
│  📋 任务模板                                              + 保存为模板 │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  从模板创建，节省重复配置时间：                                          │
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │ ⭐ 日常回归测试                                         我的    │   │
│  │                                                                  │   │
│  │ 配置：GPT-4o + 标准数据集 + 基础评估器                          │   │
│  │ 上次使用：2小时前                                               │   │
│  │                                                                  │   │
│  │                                              [使用模板] [编辑]   │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │ 🔬 新功能验证                                           团队    │   │
│  │                                                                  │   │
│  │ 配置：多模型对比 + 完整数据集 + 严格评估器                      │   │
│  │ 创建者：张三                                                    │   │
│  │                                                                  │   │
│  │                                              [使用模板] [编辑]   │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │ 🚀 发布前全量测试                                       团队    │   │
│  │                                                                  │   │
│  │ 配置：GPT-4o + 全量数据集 + 组合评估器                          │   │
│  │ 创建者：李四                                                    │   │
│  │                                                                  │   │
│  │                                              [使用模板] [编辑]   │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

**模板数据结构**：
```typescript
type TaskTemplate = {
  id: string;
  name: string;
  description?: string;
  scope: 'personal' | 'team';
  creatorId: string;
  config: {
    promptIds: string[];
    modelIds: string[];
    datasetId?: string;
    evaluatorIds: string[];
    concurrency: number;
    timeout: number;
    retryCount: number;
  };
  usageCount: number;
  lastUsedAt: Date;
  createdAt: Date;
};
```

---

### 6.6 异常检测告警卡片

在监控中心的告警区域展示：

```
┌─────────────────────────────────────────────────────────────────────────┐
│  🔔 智能异常检测                                                        │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │ ⚠️ 检测到异常模式                                    刚刚       │   │
│  │ ───────────────────────────────────────────────────────────────│   │
│  │ GPT-4 在"退款相关"问题上的通过率突然下降：                      │   │
│  │                                                                 │   │
│  │   过去7天平均: ████████████████████ 92%                        │   │
│  │   今天:        ██████████████░░░░░░ 61% (↓31%)                 │   │
│  │                                                                 │   │
│  │ 可能原因：                                                      │   │
│  │ • 提示词在 2小时前 被修改过                                    │   │
│  │ • 涉及"退款时限"的新测试用例表现较差                           │   │
│  │                                                                 │   │
│  │ [查看详情] [对比提示词版本] [暂时回滚]                          │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │ 🔵 趋势偏离提醒                                    1小时前      │   │
│  │ ───────────────────────────────────────────────────────────────│   │
│  │ Claude-3.5 响应延迟上升 40%：                                   │   │
│  │                                                                 │   │
│  │   基准延迟: 1.2s → 当前: 1.7s                                  │   │
│  │                                                                 │   │
│  │ 可能原因：API 服务压力增加                                      │   │
│  │                                                                 │   │
│  │ [标记已处理] [创建告警规则]                                     │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

**异常检测指标**：
| 指标 | 检测方法 | 触发条件 |
|------|----------|----------|
| 通过率突降 | 与近7天均值对比 | 下降 > 20% |
| 响应延迟异常 | 移动平均 + 标准差 | 偏离 > 2σ |
| 失败模式突增 | 特定类别失败占比 | 增长 > 50% |
| Token消耗异常 | 与历史对比 | 增长 > 30% |

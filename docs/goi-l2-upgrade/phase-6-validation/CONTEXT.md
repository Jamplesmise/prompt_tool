# Phase 6: 验证与集成

## 阶段目标

进行端到端测试，确保 L2 级别所有功能协同工作，修复发现的问题。

## 本阶段范围

### 需要验证的能力

| 能力 | 来源阶段 | 验证重点 |
|------|----------|----------|
| 多步骤计划生成 | Phase 1 | 计划准确性、步骤合理性 |
| 操作可视化 | Phase 2 | 执行过程透明度 |
| 检查点确认 | Phase 3 | 关键决策用户可控 |
| 暂停与接管 | Phase 4 | 控制权转移流畅 |
| 人工操作感知 | Phase 5 | 断点续跑准确性 |

### 集成测试场景

#### 场景 1：完整任务执行

```
用户输入 → 计划生成 → 逐步执行 → 检查点确认 → 任务完成
```

验证点：
- 计划包含所有必要步骤
- 执行过程实时可视化
- 关键资源选择有确认
- 任务最终完成

#### 场景 2：中途暂停续跑

```
开始执行 → 用户暂停 → 查看状态 → 继续执行 → 任务完成
```

验证点：
- 暂停响应及时（<500ms）
- 暂停状态显示准确
- 续跑从正确位置开始
- 不丢失已完成工作

#### 场景 3：用户接管后续跑

```
开始执行 → 用户暂停 → 用户接管 → 手动操作 → 交还 AI → 任务完成
```

验证点：
- 接管期间操作被记录
- 交还时显示操作摘要
- AI 识别用户完成的步骤
- 从正确位置继续

#### 场景 4：偏离处理

```
开始执行 → 用户暂停 → 用户接管 → 选择不同资源 → 交还 AI → 处理偏离
```

验证点：
- 检测到资源选择不同
- 给出合理警告
- 用户可选择处理方式
- 不会导致错误

## 测试矩阵

### 功能测试

| 功能 | 测试用例 | 优先级 |
|------|----------|--------|
| 计划生成 | 创建任务计划正确 | P0 |
| 计划生成 | 复杂任务多步骤拆分 | P0 |
| 操作执行 | 单步执行成功 | P0 |
| 操作执行 | 连续执行成功 | P0 |
| 检查点 | 选择资源时暂停 | P0 |
| 检查点 | 用户确认后继续 | P0 |
| 检查点 | 用户更换选择 | P1 |
| 暂停 | 点击暂停响应 | P0 |
| 暂停 | 暂停状态准确 | P0 |
| 续跑 | 从暂停点继续 | P0 |
| 接管 | 切换到手动模式 | P0 |
| 操作追踪 | 记录用户操作 | P0 |
| 操作识别 | 匹配计划步骤 | P1 |
| 偏离检测 | 检测资源不匹配 | P1 |

### 性能测试

| 指标 | 目标 | 测试方法 |
|------|------|----------|
| 暂停响应 | < 500ms | 计时测试 |
| 计划生成 | < 2s | 计时测试 |
| 操作可视化延迟 | < 100ms | 计时测试 |
| 内存占用 | < 50MB 增长 | 内存监控 |

### 兼容性测试

| 浏览器 | 版本 | 测试重点 |
|--------|------|----------|
| Chrome | 最新 | 主要测试 |
| Firefox | 最新 | 兼容验证 |
| Safari | 最新 | 兼容验证 |
| Edge | 最新 | 兼容验证 |

## 相关文件

| 文件 | 用途 |
|------|------|
| `apps/web/e2e/goi/` | E2E 测试目录 |
| `apps/web/src/lib/goi/__tests__/` | 单元测试目录 |

## 常见问题预案

### 1. 计划生成不准确

症状：
- 步骤遗漏
- 顺序错误
- 资源识别错误

解决：
- 检查意图解析器
- 补充任务模板
- 调整步骤生成逻辑

### 2. 操作执行失败

症状：
- 元素找不到
- 点击无效
- 表单提交失败

解决：
- 检查选择器
- 添加等待逻辑
- 验证页面状态

### 3. 暂停响应慢

症状：
- 点击暂停后延迟明显
- 可能执行多余步骤

解决：
- 检查暂停点设置
- 优化检查频率
- 减少原子操作粒度

### 4. 续跑位置错误

症状：
- 重复执行步骤
- 跳过步骤

解决：
- 检查状态保存
- 验证步骤匹配
- 修复计划协调器

### 5. 操作追踪遗漏

症状：
- 用户操作未记录
- 资源识别失败

解决：
- 补充事件监听
- 添加数据属性
- 扩展检测范围

## 验收标准

### L2 能力完整性

1. [ ] 用户可以通过自然语言指示 AI 执行多步骤任务
2. [ ] 任务执行过程完全透明可视
3. [ ] 关键决策点用户可确认或修改
4. [ ] 用户可随时暂停、接管、继续
5. [ ] AI 能识别用户的手动操作并正确续跑

### 稳定性要求

1. [ ] 连续执行 10 个任务无崩溃
2. [ ] 快速暂停/继续 10 次无异常
3. [ ] 接管/交还循环 5 次无状态丢失

### 用户体验

1. [ ] 所有操作有明确反馈
2. [ ] 错误情况有清晰提示
3. [ ] 不会出现卡死或无响应

## 下一步

L2 验证完成后：
1. 更新 GOI 智能等级文档
2. 整理最佳实践
3. 规划 L3 升级路线

# Phase 3: æ£€æŸ¥ç‚¹ç¡®è®¤æœºåˆ¶

## é˜¶æ®µç›®æ ‡

åœ¨å…³é”®æ“ä½œå‰è‡ªåŠ¨æš‚åœï¼Œç­‰å¾…ç”¨æˆ·ç¡®è®¤åå†ç»§ç»­ï¼Œç¡®ä¿ç”¨æˆ·å¯¹é‡è¦å†³ç­–æœ‰æ§åˆ¶æƒã€‚

## å½“å‰é—®é¢˜

### 1. AI è‡ªä½œä¸»å¼ 

å½“å‰ AI æ‰§è¡Œæ—¶ä¸ä¼šæš‚åœç¡®è®¤ï¼š
- é€‰æ‹©äº†é”™è¯¯çš„èµ„æºç”¨æˆ·ä¸çŸ¥é“
- æ‰§è¡Œäº†ä¸å¯é€†æ“ä½œæ— æ³•æŒ½å›
- äº§ç”Ÿäº†è´¹ç”¨ç”¨æˆ·ä¸çŸ¥æƒ…

### 2. ç¼ºä¹ä¿¡ä»»æ„Ÿ

ç”¨æˆ·æ— æ³•ä¿¡ä»» AI çš„é€‰æ‹©ï¼š
- ä¸çŸ¥é“ AI é€‰æ‹©çš„ä¾æ®
- æ²¡æœ‰æœºä¼šä¿®æ”¹
- æ„Ÿè§‰å¤±å»æ§åˆ¶

### 3. æ— æ³•å­¦ä¹ åå¥½

æ¯æ¬¡éƒ½å¯èƒ½é€‰é”™ï¼š
- ä¸è®°å½•ç”¨æˆ·çš„ç¡®è®¤å†å²
- ä¸å­¦ä¹ ç”¨æˆ·çš„åå¥½
- é‡å¤è¯¢é—®ç›¸åŒé—®é¢˜

## ç›¸å…³æ–‡ä»¶

| æ–‡ä»¶ | ç”¨é€” |
|------|------|
| `apps/web/src/lib/goi/checkpoint/` | æ£€æŸ¥ç‚¹ç›¸å…³é€»è¾‘ |
| `apps/web/src/components/goi/CopilotPanel/CheckpointSection.tsx` | æ£€æŸ¥ç‚¹ UI |
| `apps/web/src/app/api/goi/checkpoint/` | æ£€æŸ¥ç‚¹ API |

## è®¾è®¡æ–¹æ¡ˆ

### 1. æ£€æŸ¥ç‚¹ç±»å‹

```typescript
export type CheckpointType =
  | 'resource_selection'   // é€‰æ‹©å…³é”®èµ„æº
  | 'irreversible_action'  // ä¸å¯é€†æ“ä½œï¼ˆåˆ é™¤ã€å‘å¸ƒï¼‰
  | 'cost_incurring'       // æ¶‰åŠè´¹ç”¨
  | 'first_time'           // é¦–æ¬¡æ‰§è¡Œè¯¥ç±»æ“ä½œ
  | 'user_defined'         // ç”¨æˆ·è‡ªå®šä¹‰è§„åˆ™
  | 'low_confidence'       // AI ç½®ä¿¡åº¦ä½
```

### 2. æ£€æŸ¥ç‚¹æ•°æ®ç»“æ„

```typescript
export type Checkpoint = {
  id: string
  stepId: string
  type: CheckpointType
  // æ˜¾ç¤ºä¿¡æ¯
  title: string
  description: string
  // AI çš„é€‰æ‹©
  aiChoice: {
    value: string
    label: string
    reason: string           // AI é€‰æ‹©çš„ç†ç”±
    confidence: number
  }
  // å¯é€‰é¡¹
  alternatives: Array<{
    value: string
    label: string
    description?: string
  }>
  // ç”¨æˆ·å“åº”
  response?: {
    action: 'confirm' | 'change' | 'skip'
    selectedValue?: string
    timestamp: Date
  }
  // æ—¶é—´
  createdAt: Date
  expiresAt?: Date           // è¶…æ—¶æ—¶é—´
}
```

### 3. æ£€æŸ¥ç‚¹å¯¹è¯æ¡†è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â¸ï¸ è¯·ç¡®è®¤                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                     â”‚
â”‚ å³å°†é€‰æ‹©çš„ Promptï¼š                                  â”‚
â”‚                                                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚ â”‚ âœ“ sentiment-analysis-v2                         â”‚â”‚
â”‚ â”‚   æƒ…æ„Ÿåˆ†ææç¤ºè¯ï¼Œæ”¯æŒå¤šåˆ†ç±»                      â”‚â”‚
â”‚ â”‚   ğŸ’¡ é€‰æ‹©åŸå› ï¼šåç§°æœ€åŒ¹é…"æƒ…æ„Ÿåˆ†æ"               â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                     â”‚
â”‚ å…¶ä»–å€™é€‰ï¼š                                          â”‚
â”‚ â—‹ sentiment-analysis-v1 (æ—§ç‰ˆæœ¬)                   â”‚
â”‚ â—‹ emotion-classifier (æƒ…ç»ªåˆ†ç±»å™¨)                   â”‚
â”‚                                                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚ â”‚ [âœ“ ç¡®è®¤ä½¿ç”¨] [âœ æ¢ä¸€ä¸ª] [â­ è·³è¿‡æ­¤æ­¥]            â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                     â”‚
â”‚ ğŸ’¡ ç¡®è®¤åï¼ŒAI å°†ç»§ç»­æ‰§è¡Œä¸‹ä¸€æ­¥                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4. è§¦å‘è§„åˆ™é…ç½®

```typescript
export type CheckpointRule = {
  id: string
  name: string
  description: string
  // è§¦å‘æ¡ä»¶
  trigger: {
    resourceType?: ResourceType[]
    actionType?: ('select' | 'create' | 'delete' | 'update')[]
    confidence?: { lessThan: number }
    custom?: (step: PlanStep) => boolean
  }
  // æ˜¯å¦å¯ç”¨
  enabled: boolean
  // ä¼˜å…ˆçº§
  priority: number
}

// é»˜è®¤è§„åˆ™
export const DEFAULT_CHECKPOINT_RULES: CheckpointRule[] = [
  {
    id: 'select-key-resource',
    name: 'é€‰æ‹©å…³é”®èµ„æº',
    description: 'é€‰æ‹© Promptã€Datasetã€Model æ—¶æš‚åœç¡®è®¤',
    trigger: {
      resourceType: ['prompt', 'dataset', 'model'],
      actionType: ['select'],
    },
    enabled: true,
    priority: 100,
  },
  {
    id: 'irreversible-action',
    name: 'ä¸å¯é€†æ“ä½œ',
    description: 'åˆ é™¤ã€å‘å¸ƒç­‰æ“ä½œå‰ç¡®è®¤',
    trigger: {
      actionType: ['delete'],
    },
    enabled: true,
    priority: 200,
  },
  {
    id: 'low-confidence',
    name: 'ä½ç½®ä¿¡åº¦',
    description: 'AI å¯¹é€‰æ‹©ä¸ç¡®å®šæ—¶ç¡®è®¤',
    trigger: {
      confidence: { lessThan: 0.8 },
    },
    enabled: true,
    priority: 50,
  },
]
```

## éªŒæ”¶æ ‡å‡†

1. [x] é€‰æ‹© Prompt/Dataset/Model æ—¶è‡ªåŠ¨æš‚åœ
2. [x] æ˜¾ç¤º AI é€‰æ‹©çš„åŸå› å’Œå€™é€‰é¡¹
3. [x] ç”¨æˆ·å¯ä»¥ç¡®è®¤ã€æ›´æ¢æˆ–è·³è¿‡
4. [x] ä¸å¯é€†æ“ä½œå¿…é¡»ç¡®è®¤
5. [x] æ”¯æŒé…ç½®æ£€æŸ¥ç‚¹è§„åˆ™
6. [x] æ£€æŸ¥ç‚¹å“åº”åè‡ªåŠ¨ç»§ç»­æ‰§è¡Œ

## ä¾èµ–

- Phase 2 å®Œæˆï¼ˆæ“ä½œå¯è§†åŒ–ï¼‰

## ä¸‹ä¸€é˜¶æ®µ

å®Œæˆæœ¬é˜¶æ®µåï¼Œè¿›å…¥ Phase 4ï¼šæš‚åœä¸æ¥ç®¡
